# Codebase Structure

**Analysis Date:** 2026-02-13

## Directory Layout

```
C:\Users\rinoa\Desktop\PortalHC_KPB\
├── Controllers/              # MVC controllers handling HTTP requests
├── Models/                   # Entity models, ViewModels, domain logic
├── Views/                    # Razor templates organized by controller
├── Data/                     # Entity Framework DbContext, migrations, seed data
├── Properties/               # Project metadata and launch settings
├── wwwroot/                  # Static files (CSS, JS, images, libraries)
├── Migrations/               # EF Core migration files (database schema versions)
├── Database/                 # Database documentation and setup guides
├── .github/                  # GitHub configuration and CI/CD
├── .planning/                # Planning documents (this structure)
├── obj/                      # Compiler output (generated, not committed)
├── bin/                      # Build output (generated, not committed)
├── HcPortal.csproj          # Project file (targets net8.0)
├── Program.cs                # Application startup and service configuration
├── appsettings.json          # Configuration (connection strings, logging)
├── appsettings.Development.json
└── appsettings.Production.json
```

## Directory Purposes

**Controllers/**
- Purpose: HTTP request handlers for each module/feature area
- Contains: Classes inheriting from `Controller`
- Key files:
  - `AccountController.cs`: Authentication flows (login, logout, profile, settings)
  - `HomeController.cs`: Dashboard, home page, recent activities, deadlines
  - `CMPController.cs`: CMP module (KKJ matrix, CPDP mapping, assessments, exams)
  - `CDPController.cs`: CDP module (IDP management, coaching, dashboard)
  - `BPController.cs`: BP module (talent profiles, eligibility, point system)

**Models/**
- Purpose: Data entities, ViewModels, and domain logic
- Contains: Classes representing database tables and view data structures
- Key entity files:
  - `ApplicationUser.cs`: Extended user with organizational properties (NIP, Section, RoleLevel)
  - `AssessmentSession.cs`: Assessment/exam instance with metadata
  - `AssessmentQuestion.cs`: Question and AssessmentOption (answer choices)
  - `UserResponse.cs`: User's answer to a question in an assessment
  - `IdpItem.cs`: Individual Development Plan item (competency development)
  - `TrainingRecord.cs`: Training/certification record with expiry tracking
  - `CoachingLog.cs`: Coaching session documentation
  - `KkjModels.cs`: KkjMatrixItem (skill matrix) and CpdpItem (competency framework)
- View model files:
  - `DashboardHomeViewModel.cs`: Dashboard statistics, activities, deadlines
  - `DashboardViewModel.cs`: IDP/assessment dashboard data
- Support files:
  - `UserRoles.cs`: Role constants and RBAC helper methods
  - `ErrorViewModel.cs`: Error page display model

**Views/**
- Purpose: Server-rendered HTML templates for user interface
- Contains: `.cshtml` files (Razor syntax)
- Organization: Subdirectories mirror Controller names
  - `Account/`: Login, Profile, Settings views
  - `Home/`: Index (dashboard), Privacy
  - `CMP/`: KKJ matrix, mapping, assessment lobby, exam, create/edit assessment
  - `CDP/`: IDP dashboard, coaching forms, progress tracking
  - `BP/`: Talent profiles, eligibility validator, point system
  - `Shared/`: Layout template (`_Layout.cshtml`), error pages, validation scripts

**Data/**
- Purpose: Entity Framework Core database context and data seeding
- Contains:
  - `ApplicationDbContext.cs`: DbContext with entity configurations, relationships, constraints
  - `SeedData.cs`: Create roles and sample users during application startup
  - `SeedMasterData.cs`: Populate KKJ matrix, CPDP items, sample training records

**Properties/**
- Purpose: Project metadata and runtime configuration
- Contains:
  - `launchSettings.json`: Debug launch profiles (IIS Express, direct app execution)

**wwwroot/**
- Purpose: Static files served directly without processing
- Contains: CSS, JavaScript, images, third-party libraries
- Subdirectories:
  - `css/`: Application stylesheets
  - `js/`: Client-side scripts
  - `lib/`: Third-party libraries (jQuery, Bootstrap, jQuery validation)
  - `images/`: Static images and icons

**Migrations/**
- Purpose: Database schema version history tracked as C# classes
- Contains: Migration files (auto-generated by EF Core)
- Key files:
  - `20260206113657_InitialSqlServer.cs`: Initial schema creation
  - `20260209010204_AddAllEntities.cs`: Add core entities
  - `20260212110029_AssessmentSystemImprovements.cs`: Assessment refinements
  - `ApplicationDbContextModelSnapshot.cs`: Current schema snapshot
- Note: These are generated by EF Core commands; modifications should use migrations, not direct editing

**Database/**
- Purpose: Database setup and management documentation
- Contains: Setup guides, connection instructions, troubleshooting

**.github/**
- Purpose: GitHub-specific configuration
- Contains:
  - `copilot-instructions.md`: AI assistant instructions

**.planning/**
- Purpose: GSD (Getting Stuff Done) planning documents
- Contains:
  - `config.json`: Planning configuration
  - `codebase/`: Architecture, structure, conventions, testing, concerns documents (this directory)

**obj/ and bin/**
- Purpose: Build artifacts (auto-generated, not committed)
- Note: Part of `.gitignore`

## Key File Locations

**Entry Points:**
- `Program.cs`: Application startup, service registration, middleware configuration
  - Configures MVC, DbContext, Identity, Session
  - Runs migrations and seeds database
  - Sets default route to `/Account/Login`

**Configuration:**
- `appsettings.json`: Default configuration (connection string, logging)
- `appsettings.Development.json`: Development-specific overrides
- `appsettings.Production.json`: Production-specific overrides
- `HcPortal.csproj`: .NET 8.0 target framework, EntityFrameworkCore packages

**Core Logic:**
- `Controllers/HomeController.cs`: Dashboard logic (filtering by role/view, aggregating statistics)
- `Controllers/CMPController.cs`: Assessment management (create, list, start exam)
- `Data/ApplicationDbContext.cs`: Database schema and relationship configuration
- `Models/UserRoles.cs`: RBAC helper logic (role hierarchy, access checks)

**Testing:**
- Test files not detected in codebase

## Naming Conventions

**Files:**
- Controller files: `{FeatureName}Controller.cs` (e.g., `CMPController.cs`)
- Model files: `{EntityName}.cs` (e.g., `AssessmentSession.cs`)
- View files: `{ActionName}.cshtml` (e.g., `Index.cshtml`, `Login.cshtml`)
- Migration files: `{Timestamp}_{MigrationName}.cs`
- Migrations are timestamped for automatic ordering

**Directories:**
- Controllers: Plural lowercase (`Controllers/`)
- Models: Plural lowercase (`Models/`)
- Views: Plural capitalized, mirror controller names (`Views/Account/`, `Views/CMP/`)
- Static files: All lowercase in `wwwroot/`

**C# Classes:**
- Controllers: PascalCase with "Controller" suffix (e.g., `AccountController`)
- Models: PascalCase (e.g., `ApplicationUser`, `AssessmentSession`)
- Model properties: PascalCase (e.g., `UserId`, `FullName`)
- Role constants: UPPERCASE (e.g., `Admin`, `Coachee`)
- Methods: PascalCase (e.g., `GetRoleLevel()`, `HasFullAccess()`)

**HTML/Razor:**
- View files: PascalCase (e.g., `Login.cshtml`, `CreateAssessment.cshtml`)
- CSS classes: kebab-case (e.g., `bg-primary`, `urgency-class`)
- Form field names: match model properties (e.g., `@Html.TextBoxFor(m => m.Email)`)

## Where to Add New Code

**New Feature/Module:**
- Primary code: Create new Controller in `Controllers/{FeatureName}Controller.cs`
- Models: Add entity/view models to `Models/` directory
- Views: Create subdirectory `Views/{FeatureName}/` with action-named `.cshtml` files
- Database: Add DbSet to `ApplicationDbContext.cs` if new entity type
- Routing: Add route mapping in `Program.cs` (automatic via `MapControllerRoute`)

**New Entity Type:**
- Model file: `Models/{EntityName}.cs` with properties and navigation properties
- DbContext: Add `public DbSet<{EntityName}> {EntityNamePlural} { get; set; }` in `ApplicationDbContext.cs`
- Relationships: Configure in `OnModelCreating()` method with `HasOne()`, `HasMany()`, `WithMany()`
- Migration: Run `dotnet ef migrations add {MigrationName}` then `dotnet ef database update`

**New View/Page:**
- File: `Views/{ControllerName}/{ActionName}.cshtml`
- Model directive: `@model {ViewModelType}` at top of file
- Layout reference: `@{ ViewData["Title"] = "Page Title"; }` for page metadata
- Shared components: Reference in `Views/Shared/_Layout.cshtml`

**New Role or Permission:**
- Role string: Add constant to `Models/UserRoles.cs`
- Role level: Add case in `GetRoleLevel()` switch statement
- Seeding: Add role to `Data/SeedData.cs` for automatic creation on startup
- Authorization: Check role/level in controller using `UserRoles` helper methods

**Utilities or Helpers:**
- Shared functions: Add as static methods in `Models/UserRoles.cs` or create new helper class
- Extension methods: Create new file in `Models/` directory
- View helpers: Use Razor components (partial views) in `Views/Shared/`

## Special Directories

**Migrations/**
- Purpose: Track database schema changes as code
- Generated: Yes (auto-generated by EF Core CLI)
- Committed: Yes (critical for reproducing schema in other environments)
- Management: Only modify via `dotnet ef migrations add` command; never edit migration files directly
- Safety: Each migration is a separate file with `Up()` and `Down()` methods for reversibility

**wwwroot/**
- Purpose: Static asset delivery without server processing
- Generated: No (manually added or from npm packages)
- Committed: Yes (CSS, JS, library files)
- Structure: Organized by file type (`css/`, `js/`, `lib/`, `images/`)

**obj/ and bin/**
- Purpose: Compiler and build output
- Generated: Yes (during build)
- Committed: No (in `.gitignore`)
- Purpose: Not source code; safe to delete and rebuild

**Properties/**
- Purpose: Project configuration metadata
- Generated: Partially (auto-generated on first project creation)
- Committed: Yes (launch settings are part of project)

---

*Structure analysis: 2026-02-13*
