# Roadmap: Portal HC KPB — v2.1 Assessment Resilience & Real-Time Monitoring

## Milestone Overview

Workers stop losing progress when they disconnect and HC gets live visibility into who has answered what. Four independent-but-ordered capabilities: answers are saved automatically on every selection and page navigation, disconnected workers resume exactly where they left off with accurate time remaining, the exam page detects HC-initiated closure and redirects workers automatically, and HC sees per-worker answer progress update live without a page reload.

**Milestone:** v2.1 Assessment Resilience & Real-Time Monitoring
**Phases:** 41–44
**Requirements covered:** 11 (SAVE-01–03, RESUME-01–03, POLL-01–02, MONITOR-01–03)
**Depends on:** v2.0 complete (Phase 40)

---

## Phases

- [ ] **Phase 41: Auto-Save** — Worker answers are saved to the server automatically on each radio selection and before each page navigation, with atomic upsert preventing data corruption under concurrent requests
- [ ] **Phase 42: Session Resume** — A worker who disconnects mid-exam resumes at their last page with pre-populated answers and server-calculated remaining time, not a fresh exam start
- [ ] **Phase 43: Worker Polling** — The exam page polls every 10 seconds and auto-redirects the worker to their Results page the moment HC closes the session early
- [ ] **Phase 44: HC Live Monitoring** — HC sees an "Answered / Total" count per worker on MonitoringDetail that refreshes every 5–10 seconds without a full page reload; NIP column removed

---

## Phase Details

### Phase 41: Auto-Save

**Goal:** Worker answers are persisted to the server immediately on each radio button click and before any page navigation — workers never lose answers due to accidental browser close, disconnection during a page turn, or final submission timing
**Depends on:** Phase 40 (v2.0 complete)
**Requirements:** SAVE-01, SAVE-02, SAVE-03
**Success Criteria** (what must be TRUE):
  1. Worker selects a radio button — the answer is sent to SaveAnswer via AJAX within 500ms with no manual action required
  2. Worker clicks Prev or Next — the page does not navigate until all in-flight SaveAnswer requests for the current page have completed; a "Saving..." indicator is shown during the wait
  3. Worker rapidly clicks the same radio multiple times — only one final answer is recorded in the database; no duplicate rows exist in PackageUserResponse for the same (SessionId, QuestionId)
  4. Two workers answering questions simultaneously on the same assessment — each worker's answers are saved independently with no data corruption or overwrite of the other worker's data
**Plans:** TBD

Plans:
- [ ] 41-01: Backend — harden SaveAnswer with ExecuteUpdateAsync atomic upsert; enforce unique constraint on (SessionId, QuestionId) in PackageUserResponse; add RowVersion [Timestamp] for optimistic concurrency
- [ ] 41-02: Frontend — add debounce(300ms) radio-change handler to Exam.cshtml; block Prev/Next navigation until all pending SaveAnswer fetches resolve; show saving indicator

---

### Phase 42: Session Resume

**Goal:** A worker who closes their browser or loses connection during an exam can return and continue from exactly where they left off — correct page, pre-selected answers, and accurate remaining time recalculated server-side
**Depends on:** Phase 41 (auto-save must be stable before resume state can be trusted)
**Requirements:** RESUME-01, RESUME-02, RESUME-03
**Success Criteria** (what must be TRUE):
  1. Worker is on exam page 3 and closes the browser — on returning to the exam, they land on page 3, not page 1
  2. Worker has answered 12 of 20 questions and disconnects — on resuming, those 12 questions show their previously selected answers pre-populated
  3. Worker had 18 minutes remaining when they disconnected — on resuming, the countdown timer shows the server-calculated remaining time (not a fresh full duration), accurate to within 5 seconds
  4. Worker resumes an exam where the question set was changed after they started — the system blocks resume with a clear message rather than showing a broken or mismatched page
**Plans:** TBD

Plans:
- [ ] 42-01: Backend — EF Core migration adding LastPageIndex and ElapsedSeconds columns to AssessmentSession; new UpdateSessionProgress POST endpoint to save page/time on each navigation; enhanced StartExam GET to detect resume state and populate ViewBag with stored values; question-count validation on UpdateSessionProgress
- [ ] 42-02: Frontend — Exam.cshtml calls UpdateSessionProgress on each page navigation after all saves complete; StartExam reads resume ViewBag values to initialize page index and reset countdown timer from server-calculated remaining time

---

### Phase 43: Worker Polling

**Goal:** The exam page automatically detects when HC closes the session early and redirects the worker to their Results page — workers are never stuck on the exam page after their session has been closed
**Depends on:** Phase 42 (session state must be stable before polling reacts to it)
**Requirements:** POLL-01, POLL-02
**Success Criteria** (what must be TRUE):
  1. HC closes an active assessment group using "Tutup Lebih Awal" — within 10–30 seconds, every worker currently on the exam page sees a redirect to their Results page without manually refreshing
  2. A worker actively taking the exam with 100 other concurrent workers — the polling does not cause noticeable page slowdown or database overload; CheckExamStatus serves most requests from memory cache (target: less than 30% DB CPU at 100 concurrent workers)
**Plans:** TBD

Plans:
- [ ] 43-01: Backend — add IMemoryCache registration; enhance CheckExamStatus with 5-second TTL cache keyed by session ID; invalidate cache on CloseEarlySession
- [ ] 43-02: Frontend — add setInterval polling loop to Exam.cshtml calling CheckExamStatus every 10–30 seconds; on closed/completed status, redirect to Results page URL

---

### Phase 44: HC Live Monitoring

**Goal:** HC sees each worker's real-time answer progress ("X / Y answered") on the MonitoringDetail page updating automatically every 5–10 seconds — no full page reload needed, scroll position and filter state are preserved; the NIP column is removed from the per-user status table
**Depends on:** Phase 43 (monitoring endpoint reuses caching infrastructure from polling)
**Requirements:** MONITOR-01, MONITOR-02, MONITOR-03
**Success Criteria** (what must be TRUE):
  1. HC opens MonitoringDetail during an active exam — each worker row shows an "Answered / Total" progress count (e.g., "12 / 30") reflecting how many questions that worker has saved answers for
  2. HC watches the MonitoringDetail page — progress counts update within 5–10 seconds as workers answer questions, without HC doing a manual page refresh
  3. HC scrolls down the MonitoringDetail table before an auto-refresh fires — after the refresh, the page remains at the same scroll position and any active filter selection is preserved
  4. NIP column is absent from the MonitoringDetail per-user status table — the column does not appear in the table header or any data rows
**Plans:** TBD

Plans:
- [ ] 44-01: Backend — new GetMonitoringProgress GET endpoint returning JSON array of {SessionId, AnsweredCount, TotalQuestions} for all sessions in a group; single GROUP BY query against PackageUserResponse; 10-second memory cache keyed by assessment group identity
- [ ] 44-02: Frontend — add Progress column to AssessmentMonitoringDetail.cshtml; remove NIP column; add setInterval AJAX refresh loop (5–10s) calling GetMonitoringProgress and updating progress cells in-place without page reload; preserve scroll position

---

## Coverage Validation

| Requirement | Phase | Status |
|-------------|-------|--------|
| SAVE-01 | Phase 41 | Pending |
| SAVE-02 | Phase 41 | Pending |
| SAVE-03 | Phase 41 | Pending |
| RESUME-01 | Phase 42 | Pending |
| RESUME-02 | Phase 42 | Pending |
| RESUME-03 | Phase 42 | Pending |
| POLL-01 | Phase 43 | Pending |
| POLL-02 | Phase 43 | Pending |
| MONITOR-01 | Phase 44 | Pending |
| MONITOR-02 | Phase 44 | Pending |
| MONITOR-03 | Phase 44 | Pending |

**Coverage: 11 / 11 requirements mapped. No orphans.**

---

## Progress

| Phase | Milestone | Plans Complete | Status | Completed |
|-------|-----------|----------------|--------|-----------|
| 41. Auto-Save | v2.1 | 0/2 | Not started | — |
| 42. Session Resume | v2.1 | 0/2 | Not started | — |
| 43. Worker Polling | v2.1 | 0/2 | Not started | — |
| 44. HC Live Monitoring | v2.1 | 0/2 | Not started | — |

---

*Created: 2026-02-24*
*Milestone: v2.1 Assessment Resilience & Real-Time Monitoring*
