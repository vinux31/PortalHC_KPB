---
phase: 42-session-resume
plan: 04
type: execute
wave: 4
depends_on: ["42-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Worker can see Resume button (yellow/warning) on assignment card when session is InProgress"
    - "Clicking Resume shows modal 'Ada ujian yang belum selesai — lanjutkan dari soal no. X?' with only 'Lanjutkan' button"
    - "After Lanjutkan, exam loads at the saved page with previous answers pre-checked"
    - "Timer shows remaining time (not full duration) from the moment exam loads"
    - "Answered count reflects pre-populated answers immediately"
    - "Network tab shows UpdateSessionProgress POSTing every ~30s and on each page nav"
  artifacts:
    - path: "Views/CMP/Assessment.cshtml"
      provides: "Resume button visible for InProgress sessions"
      contains: "btn-warning"
    - path: "Views/CMP/StartExam.cshtml"
      provides: "Resume modal + timer init + answer pre-population + progress save"
      contains: "resumeConfirmModal"
  key_links:
    - from: "Assignment card Resume button"
      to: "StartExam GET"
      via: "direct navigation (no JS, btn-warning anchor)"
      pattern: "InProgress"
    - from: "StartExam JS init"
      to: "resumeConfirmModal"
      via: "bootstrap.Modal show() on IS_RESUME && RESUME_PAGE > 0"
      pattern: "IS_RESUME"
---

<objective>
Human verification that session resume works end-to-end: resume button, modal, page navigation, timer, answer pre-population, and progress save all behave exactly as specified.

Purpose: Phase 42 requirements (RESUME-01, RESUME-02, RESUME-03) are only satisfied when observable in a real browser with real data. This checkpoint confirms the implementation is correct before marking the phase complete.
Output: Human approval or issue report for gap closure.
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/42-session-resume/42-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Human end-to-end verification of session resume</name>
  <files>Views/CMP/Assessment.cshtml, Views/CMP/StartExam.cshtml</files>
  <action>Human performs end-to-end verification of the session resume flow per the how-to-verify steps below.</action>
  <verify>See how-to-verify steps below.</verify>
  <done>User types "approved" confirming: Resume button visible (yellow), resume modal appears with correct page number, exam loads at saved page with pre-filled answers, timer shows remaining time, UpdateSessionProgress fires on nav and every 30s.</done>
  <what-built>
    Full session resume system:
    - Plan 01: DB migration adding ElapsedSeconds, LastActivePage (AssessmentSession) and SavedQuestionCount (UserPackageAssignment)
    - Plan 02: UpdateSessionProgress POST endpoint; StartExam GET enhanced with resume detection, stale check, saved answers JSON, remaining time calculation
    - Plan 03: Assessment.cshtml Resume button (btn-warning) for InProgress; StartExam.cshtml resume modal, timer from remaining time, answer pre-population, 30s + nav progress save, expired path
  </what-built>
  <how-to-verify>
    Run the app: `dotnet run` in the project directory.

    **Test 1 — Resume button visible:**
    1. Log in as a worker who has an InProgress exam (start one, then close the browser mid-exam).
    2. Navigate to /CMP/Assessment.
    3. Confirm: The assignment card shows a yellow "Resume" button (not "Start Assessment").
    4. Confirm: Clicking Resume navigates to /CMP/StartExam/{id}.

    **Test 2 — Resume modal:**
    1. On the StartExam page after clicking Resume:
    2. Confirm: A modal appears titled "Ada ujian yang belum selesai" with body showing "Lanjutkan dari soal no. X?" (X = the page number where you left off, 1-based).
    3. Confirm: Only one button: "Lanjutkan" (no cancel, no restart option).
    4. Confirm: Clicking outside the modal does nothing (data-bs-backdrop="static").

    **Test 3 — Correct page + pre-populated answers:**
    1. After clicking "Lanjutkan":
    2. Confirm: Exam loads on the page where you left off (not page 1).
    3. Confirm: Questions you previously answered show their radio button pre-checked.
    4. Confirm: Unanswered questions show empty (no special highlight or cue).
    5. Confirm: Answered count badge (e.g., "12/30 answered") correctly reflects pre-populated answers immediately — not 0.

    **Test 4 — Timer starts at remaining time:**
    1. Confirm: Timer shows the remaining time (approximately equal to exam duration minus time already spent), NOT the full exam duration.
    2. Example: If exam is 60 min and you spent 5 min before closing, timer should show ~55:XX, not 60:00.

    **Test 5 — Progress save (open browser DevTools → Network tab):**
    1. Filter network requests for "UpdateSessionProgress".
    2. Navigate to a different page (Prev/Next) — confirm: UpdateSessionProgress POST fires immediately.
    3. Wait 30 seconds idle — confirm: UpdateSessionProgress POST fires automatically.
    4. Confirm: Response is `{"success":true}`.

    **Test 6 — Free navigation works:**
    1. From the resumed page, click Prev and Next freely.
    2. Confirm: All pages accessible normally with their pre-populated answers.
  </how-to-verify>
  <resume-signal>Type "approved" if all 6 tests pass. Describe any issues found if not.</resume-signal>
</task>

</tasks>

<verification>
Human verification covers all RESUME-0x requirements:
- RESUME-01: Worker can resume from where they left off (correct page, pre-populated answers)
- RESUME-02: Timer restored from elapsed time, not wall-clock (offline time excluded)
- RESUME-03: Stale question detection (requires HC to test — acceptable to verify code path via inspection if HC test is not feasible)
</verification>

<success_criteria>
Human confirms: Resume button visible, modal appears with correct page number, exam loads at saved page with pre-filled answers and correct remaining timer, progress saves on navigation and every 30 seconds. Phase 42 marked complete.
</success_criteria>

<output>
After completion, create `.planning/phases/42-session-resume/42-04-SUMMARY.md`
</output>
