---
phase: 08-fix-admin-role-switcher-and-add-admin-to-supported-roles
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Controllers/AccountController.cs
  - Views/Shared/_Layout.cshtml
  - Data/SeedData.cs
autonomous: true

must_haves:
  truths:
    - "Admin can switch to 'Admin View' via the role-switcher dropdown"
    - "Admin View is shown as active (checkmark) when SelectedView is 'Admin'"
    - "Switching to Admin View is accepted by AccountController without BadRequest"
    - "Seeded Admin account defaults to SelectedView='Admin' (not 'HC')"
  artifacts:
    - path: "Controllers/AccountController.cs"
      provides: "SwitchView action with 'Admin' in allowedViews"
      contains: "Admin"
    - path: "Views/Shared/_Layout.cshtml"
      provides: "Admin View dropdown option with checkmark indicator"
      contains: "Admin View"
    - path: "Data/SeedData.cs"
      provides: "Admin seed user with SelectedView = 'Admin'"
      contains: "SelectedView = \"Admin\""
  key_links:
    - from: "Views/Shared/_Layout.cshtml"
      to: "Controllers/AccountController.cs"
      via: "asp-action='SwitchView' asp-route-view='Admin'"
      pattern: "SwitchView.*Admin"
    - from: "Controllers/AccountController.cs"
      to: "ApplicationUser.SelectedView"
      via: "allowedViews array check then DB persist"
      pattern: "allowedViews.*Admin"
---

<objective>
Enable "Admin" as a valid role-switcher view — in the allowed-views list, the dropdown UI, and the seed data default.

Purpose: Without this, Admin cannot select "Admin View" from the dropdown (BadRequest on attempt) and the dropdown has no entry for it. This is the prerequisite that unlocks all subsequent Admin-as-Admin behavior.
Output: AccountController accepts "Admin" as a view value; _Layout shows an "Admin View" dropdown item with checkmark; Admin seed user starts in "Admin" view.
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-fix-admin-role-switcher-and-add-admin-to-supported-roles/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add "Admin" to allowedViews and fix seed default</name>
  <files>Controllers/AccountController.cs, Data/SeedData.cs</files>
  <action>
    In `Controllers/AccountController.cs`, find the `allowedViews` array at line ~138:
    ```csharp
    var allowedViews = new[] { "HC", "Atasan", "Coach", "Coachee" };
    ```
    Change it to:
    ```csharp
    var allowedViews = new[] { "HC", "Atasan", "Coach", "Coachee", "Admin" };
    ```
    No other change needed in AccountController — the existing logic (set user.SelectedView = view, SaveChanges) works unchanged.

    In `Data/SeedData.cs`, find the Admin seed user (RoleLevel = 1) which currently has:
    ```csharp
    SelectedView = "HC"  // Admin default view
    ```
    Change it to:
    ```csharp
    SelectedView = "Admin"  // Admin default view
    ```
    This ensures a freshly seeded Admin starts in "Admin View" rather than HC view. Existing Admin accounts in the DB are not affected by this seed change (seed only runs if the user does not already exist).
  </action>
  <verify>Build the project: `dotnet build` must produce 0 errors. No runtime test needed — the change is a one-value array extension and a string literal swap.</verify>
  <done>AccountController.cs allowedViews contains "Admin"; SeedData.cs Admin SelectedView is "Admin"; build succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Add "Admin View" option to _Layout.cshtml dropdown</name>
  <files>Views/Shared/_Layout.cshtml</files>
  <action>
    In `Views/Shared/_Layout.cshtml`, find the closing `</ul>` of the role-switcher dropdown (currently after the Coachee `</li>` block, around line 144). Insert the following before that closing `</ul>`:

    ```html
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item d-flex align-items-center gap-2" asp-controller="Account" asp-action="SwitchView" asp-route-view="Admin" asp-route-returnUrl="@Context.Request.Path">
                                                <i class="bi bi-shield-fill"></i>
                                                <span>Admin View</span>
                                                @if (currentUser.SelectedView == "Admin")
                                                {
                                                    <i class="bi bi-check2 ms-auto text-primary"></i>
                                                }
                                            </a>
                                        </li>
    ```

    The divider visually separates Admin View from the role-simulation options (HC, Atasan, Coach, Coachee), since Admin View is "return to real Admin mode" rather than a simulated role.

    Match the indentation style of the existing Coachee block exactly (spaces, not tabs).
  </action>
  <verify>`dotnet build` succeeds. Visually: the Admin view dropdown item appears in the switcher in browser (human verify in plan 02 checkpoint).</verify>
  <done>_Layout.cshtml dropdown has five options (HC, Atasan, Coach, Coachee, [divider], Admin). Build succeeds with 0 errors.</done>
</task>

</tasks>

<verification>
Run `dotnet build` — must produce 0 errors, 0 relevant warnings.
Check that `allowedViews` in AccountController contains exactly 5 entries including "Admin".
Check that SeedData Admin SelectedView is "Admin".
Check that _Layout.cshtml dropdown ul contains an anchor with asp-route-view="Admin".
</verification>

<success_criteria>
- `dotnet build` exits 0 with 0 errors
- Admin can switch to "Admin View" via GET /Account/SwitchView?view=Admin without receiving BadRequest
- _Layout dropdown shows "Admin View" with shield icon and checkmark when active
- Admin seed user defaults to SelectedView = "Admin"
</success_criteria>

<output>
After completion, create `.planning/phases/08-fix-admin-role-switcher-and-add-admin-to-supported-roles/08-01-SUMMARY.md`
</output>
