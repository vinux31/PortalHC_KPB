---
phase: 09-gap-analysis-removal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Views/CMP/Index.cshtml
  - Views/CMP/CpdpProgress.cshtml
  - Controllers/CMPController.cs
  - Views/CMP/CompetencyGap.cshtml
  - Models/Competency/CompetencyGapViewModel.cs
autonomous: true

must_haves:
  truths:
    - "The Gap Analysis nav card is absent from CMP Index — no link renders for any role"
    - "The Gap Analysis cross-link is absent from CPDP Progress — no link renders for any role"
    - "Navigating directly to /CMP/CompetencyGap returns a 404, not a working page"
    - "The application builds with zero errors after the removal"
    - "Zero occurrences of the string 'CompetencyGap' remain in any .cs or .cshtml file"
  artifacts:
    - path: "Views/CMP/Index.cshtml"
      provides: "CMP hub page without Gap Analysis card"
      contains_not: "CompetencyGap"
    - path: "Views/CMP/CpdpProgress.cshtml"
      provides: "CPDP Progress page without Gap Analysis nav link"
      contains_not: "CompetencyGap"
    - path: "Controllers/CMPController.cs"
      provides: "CMP controller without CompetencyGap action or GenerateIdpSuggestion helper"
      contains_not: "CompetencyGap"
  key_links:
    - from: "Views/CMP/Index.cshtml"
      to: "Controllers/CMPController.cs"
      via: "Url.Action calls for remaining actions only"
      pattern: "No Url\\.Action.*CompetencyGap"
    - from: "Views/CMP/CpdpProgress.cshtml"
      to: "Controllers/CMPController.cs"
      via: "Url.Action calls for CpdpProgress only"
      pattern: "No Url\\.Action.*CompetencyGap"
---

<objective>
Remove the Gap Analysis feature entirely: nav links, controller action, view file, and ViewModel file.

Purpose: The Gap Analysis page is being retired as part of v1.2 UX Consolidation. Its data is not moved elsewhere — the feature is simply deleted. Removing it cleans up dead navigation and prevents user confusion.

Output: CMP Index hub and CPDP Progress page no longer reference Gap Analysis. The CompetencyGap action, view, and ViewModel are deleted. The application builds cleanly.
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-gap-analysis-removal/09-RESEARCH.md
@Views/CMP/Index.cshtml
@Views/CMP/CpdpProgress.cshtml
@Controllers/CMPController.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove nav links and delete controller action</name>
  <files>
    Views/CMP/Index.cshtml
    Views/CMP/CpdpProgress.cshtml
    Controllers/CMPController.cs
  </files>
  <action>
**Step 1 — Remove the Gap Analysis card from CMP Index hub.**

In `Views/CMP/Index.cshtml`, delete the entire Bootstrap column block for the Gap Analysis card. This is the `<!-- Competency Gap Analysis -->` comment through its closing `</div>` tags — the full `col-12 col-md-6 col-lg-4` wrapper (lines 58–77). The block starts with:
```
        <!-- Competency Gap Analysis -->
        <div class="col-12 col-md-6 col-lg-4">
```
and ends with:
```
        </div>
```
(the third closing `</div>` that closes the col div).

Do NOT touch the surrounding cards (CPDP Mapping above, Assessment Lobby below). The remaining Bootstrap grid will reflow automatically.

**Step 2 — Remove the Gap Analysis nav link from CPDP Progress.**

In `Views/CMP/CpdpProgress.cshtml`, inside the `<div class="mb-3">` navigation block (around lines 18-25), delete only the FIRST `<a>` element — the one linking to `CompetencyGap`:
```
        <a href="@Url.Action("CompetencyGap", "CMP", new { userId = Model.UserId })" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-bar-chart-steps me-1"></i>Gap Analysis
        </a>
```

Keep the `<div class="mb-3">` wrapper and the second `<a>` (the CPDP Progress self-link which is the active page indicator).

**Step 3 — Delete the CompetencyGap action from CMPController.**

In `Controllers/CMPController.cs`, delete the entire `CompetencyGap()` action method including its comment header. The block starts with:
```
        // --- COMPETENCY GAP ANALYSIS ---
```
(around line 1531) and spans through the closing brace of the `CompetencyGap` method (around line 1632). This is approximately 100 lines.

**Step 4 — Delete the GenerateIdpSuggestion helper from CMPController.**

In the same `Controllers/CMPController.cs`, delete the `GenerateIdpSuggestion()` private method (around lines 1815–1837). This helper is called exclusively from the CompetencyGap action.

**CRITICAL: Do NOT remove the `using HcPortal.Models.Competency;` directive at the top of CMPController.cs.** This namespace is still needed for `CpdpProgressViewModel`, `UserCompetencyLevel`, and `AssessmentCompetencyMap`.
  </action>
  <verify>
Run grep to confirm no CompetencyGap references remain in the three edited files:
```bash
grep -n "CompetencyGap" Views/CMP/Index.cshtml Views/CMP/CpdpProgress.cshtml Controllers/CMPController.cs
```
Expected: zero results.

Also confirm GenerateIdpSuggestion is gone:
```bash
grep -n "GenerateIdpSuggestion" Controllers/CMPController.cs
```
Expected: zero results.
  </verify>
  <done>
    - CMP Index hub renders without the Gap Analysis card (no `CompetencyGap` string anywhere in the file)
    - CPDP Progress page renders without the Gap Analysis nav link (no `CompetencyGap` string anywhere in the file)
    - CMPController.cs has no `CompetencyGap` action and no `GenerateIdpSuggestion` helper
    - The `using HcPortal.Models.Competency;` directive is still present at the top of CMPController.cs
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete orphaned files and verify clean build</name>
  <files>
    Views/CMP/CompetencyGap.cshtml
    Models/Competency/CompetencyGapViewModel.cs
  </files>
  <action>
**Step 1 — Delete the CompetencyGap view file.**

Delete the file `Views/CMP/CompetencyGap.cshtml` entirely. This is the Razor view for the now-removed controller action. Use:
```bash
rm Views/CMP/CompetencyGap.cshtml
```

**Step 2 — Delete the CompetencyGapViewModel file.**

Delete the file `Models/Competency/CompetencyGapViewModel.cs` entirely. This file contains `CompetencyGapViewModel` and `CompetencyGapItem` classes, both of which are only consumed by the deleted action and view. Use:
```bash
rm Models/Competency/CompetencyGapViewModel.cs
```

**Step 3 — Run final comprehensive grep.**

Run a codebase-wide grep to confirm zero remaining references:
```bash
grep -rn "CompetencyGap" --include="*.cs" --include="*.cshtml" .
```
Expected: zero results. If any results appear, investigate and remove the reference.

**Step 4 — Build the application.**

Run `dotnet build` and verify zero errors. The build MUST succeed cleanly. The `using HcPortal.Models.Competency;` directive in CMPController.cs should NOT cause any issues since other types in that namespace are still in use.
  </action>
  <verify>
```bash
# Codebase-wide grep — must return zero results
grep -rn "CompetencyGap" --include="*.cs" --include="*.cshtml" .

# Build must succeed
dotnet build
```
  </verify>
  <done>
    - `Views/CMP/CompetencyGap.cshtml` no longer exists on disk
    - `Models/Competency/CompetencyGapViewModel.cs` no longer exists on disk
    - Zero occurrences of "CompetencyGap" in any .cs or .cshtml file across the entire codebase
    - `dotnet build` completes with zero errors
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "CompetencyGap" --include="*.cs" --include="*.cshtml" .` returns zero results
2. `grep -rn "GenerateIdpSuggestion" --include="*.cs" .` returns zero results
3. `dotnet build` succeeds with zero errors
4. `Views/CMP/CompetencyGap.cshtml` does not exist
5. `Models/Competency/CompetencyGapViewModel.cs` does not exist
6. `Views/CMP/Index.cshtml` contains no reference to Gap Analysis or CompetencyGap
7. `Views/CMP/CpdpProgress.cshtml` contains no reference to Gap Analysis or CompetencyGap
8. `Controllers/CMPController.cs` still contains `using HcPortal.Models.Competency;`
</verification>

<success_criteria>
- The Gap Analysis feature is completely removed from the codebase
- No dead links exist in CMP Index or CPDP Progress
- The application compiles and builds successfully
- No orphaned files remain
</success_criteria>

<output>
After completion, create `.planning/phases/09-gap-analysis-removal/09-01-SUMMARY.md`
</output>
