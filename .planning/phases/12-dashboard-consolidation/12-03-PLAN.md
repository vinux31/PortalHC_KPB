---
phase: 12-dashboard-consolidation
plan: 03
type: execute
wave: 3
depends_on: ["12-02"]
files_modified:
  - Controllers/CDPController.cs
  - Controllers/CMPController.cs
  - Views/CDP/DevDashboard.cshtml
  - Views/CMP/ReportsIndex.cshtml
  - Views/Shared/_Layout.cshtml
  - Views/CMP/Index.cshtml
  - Views/CMP/UserAssessmentHistory.cshtml
  - Models/DevDashboardViewModel.cs
  - Models/DashboardViewModel.cs
autonomous: false

must_haves:
  truths:
    - "CDPController.DevDashboard() action is deleted"
    - "CMPController.ReportsIndex() action is deleted"
    - "CMPController.ExportResults() action is deleted (moved to CDPController in 12-01)"
    - "DevDashboard.cshtml view file is deleted"
    - "ReportsIndex.cshtml view file is deleted"
    - "DevDashboard nav link in _Layout.cshtml is removed and replaced with Dashboard link visible to all roles"
    - "HC Reports nav link in _Layout.cshtml is removed"
    - "No remaining reference to 'ReportsIndex' in any .cshtml file (except deleted files)"
    - "No remaining reference to 'DevDashboard' in any .cshtml file (except deleted files)"
    - "UserAssessmentHistory.cshtml Url.Action('ReportsIndex') links are removed entirely"
    - "CMP/Index.cshtml HC Reports card link is updated or removed"
    - "Application builds with 0 errors after all deletions"
  artifacts:
    - path: "Views/Shared/_Layout.cshtml"
      provides: "Dashboard nav link visible to all authenticated roles, DevDashboard and HC Reports links removed"
      contains: "asp-action=\"Dashboard\""
    - path: "Views/CMP/UserAssessmentHistory.cshtml"
      provides: "ReportsIndex links removed per locked decision"
  key_links:
    - from: "Views/Shared/_Layout.cshtml"
      to: "Controllers/CDPController.cs"
      via: "nav link asp-action=Dashboard"
      pattern: "asp-controller=\"CDP\" asp-action=\"Dashboard\""
    - from: "Views/CMP/UserAssessmentHistory.cshtml"
      to: "Controllers/CMPController.cs"
      via: "UserAssessmentHistory action stays on CMPController"
      pattern: "UserAssessmentHistory"
---

<objective>
Delete both standalone pages (Dev Dashboard and HC Reports) and clean up every cross-controller reference. Replace the DevDashboard nav link with a role-unrestricted Dashboard nav link. This completes the consolidation by ensuring no dead routes remain.

Purpose: Without this cleanup, deleted actions produce 404s from orphaned links. The nav change makes Dashboard accessible to Coachees for the first time.

Output: Deleted files (DevDashboard.cshtml, ReportsIndex.cshtml, DevDashboardViewModel.cs, DashboardViewModel.cs), cleaned _Layout.cshtml, cleaned CDPController.cs, cleaned CMPController.cs, cleaned CMP views
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-dashboard-consolidation/12-CONTEXT.md
@.planning/phases/12-dashboard-consolidation/12-RESEARCH.md
@.planning/phases/12-dashboard-consolidation/12-01-SUMMARY.md
@.planning/phases/12-dashboard-consolidation/12-02-SUMMARY.md
@Views/Shared/_Layout.cshtml
@Views/CMP/Index.cshtml
@Views/CMP/UserAssessmentHistory.cshtml
@Controllers/CDPController.cs
@Controllers/CMPController.cs
@Models/DevDashboardViewModel.cs
@Models/DashboardViewModel.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pre-deletion reference audit and cleanup of surviving files</name>
  <files>
    Views/Shared/_Layout.cshtml
    Views/CMP/Index.cshtml
    Views/CMP/UserAssessmentHistory.cshtml
    Views/CDP/Dashboard.cshtml
    Controllers/CDPController.cs
    Controllers/CMPController.cs
  </files>
  <action>
**Step 0 — Pre-implementation grep (per CONTEXT.md specifics):**

Before any changes, run these greps and document findings:
```bash
grep -rn "ReportsIndex" --include="*.cshtml" --include="*.cs" .
grep -rn "DevDashboard" --include="*.cshtml" --include="*.cs" .
grep -rn "ExportResults" --include="*.cshtml" --include="*.cs" .
grep -rn "DashboardViewModel" --include="*.cshtml" --include="*.cs" .
grep -rn "DevDashboardViewModel" --include="*.cshtml" --include="*.cs" .
```

Address EVERY hit that references a file/action being deleted. The reference inventory from RESEARCH.md:

**Step 1 — _Layout.cshtml nav changes:**

1. **Remove** the Dev Dashboard `<li>` block (currently ~lines 63-74, visible to Coach/SrSupervisor/SectionHead/HC/Admin only). Remove the entire conditional block and its `<li>`.

2. **Remove** the HC Reports nav link. It is inside the CMP dropdown, gated by Admin/HC role check. Remove just the Reports `<li>` item (the CMP dropdown itself stays for other CMP items like Assessment, Training Records).

3. **Add** a new Dashboard nav `<li>` with NO role gate — all authenticated users see it (per locked decision: label "Dashboard", accessible to Coachees):
   ```html
   <li class="nav-item">
       <a class="nav-link text-dark" asp-controller="CDP" asp-action="Dashboard">
           <i class="bi bi-speedometer2 me-1"></i>Dashboard
       </a>
   </li>
   ```
   Place it near the top of the nav items (before CDP/CMP dropdowns) so Dashboard is the first nav item.

**Step 2 — CMP/Index.cshtml (HC Reports card):**

Line ~116 has a card linking to `@Url.Action("ReportsIndex", "CMP")`. Two options:
- Option A (preferred): Update the card to link to the Analytics tab on Dashboard: `@Url.Action("Dashboard", "CDP")` — the Analytics tab is the replacement for HC Reports.
- Option B: Remove the card entirely.

Choose Option A — it preserves the CMP hub's link structure for HC users. Update the card title from "HC Reports" or "Assessment Reports" to "Assessment Analytics" and update the link to `asp-controller="CDP" asp-action="Dashboard"`.

**Step 3 — CMP/UserAssessmentHistory.cshtml:**

Per locked decision: "Url.Action('ReportsIndex') calls in UserAssessmentHistory.cshtml: remove the links entirely (no replacement link)."

Find both references (research says line ~11 breadcrumb and line ~201 back button):
- Line ~11: breadcrumb link to ReportsIndex — REMOVE the entire breadcrumb `<li>` or `<a>` for Reports Index. If it's part of a breadcrumb trail, remove just the Reports Index crumb. Keep the page functional.
- Line ~201: "Back to Reports" button/link — REMOVE the entire element. Do NOT replace with a Dashboard link (per locked decision: "remove the links entirely").

Claude's discretion: UserAssessmentHistory.cshtml is KEPT as a drill-down from the Analytics tab (per research recommendation). The action `CMPController.UserAssessmentHistory()` stays intact on CMPController.

**Step 4 — Dashboard.cshtml reference cleanup:**

Check if the old Dashboard.cshtml (now rewritten in 12-02) has any remaining reference to ReportsIndex (research says line ~97 had a link to CMP/ReportsIndex). Since 12-02 rewrote the file, this should already be gone. Verify and remove if present.

**Step 5 — CDPController.cs:**

Delete the `DevDashboard()` action method entirely. This is the GET action that returns DevDashboard.cshtml. Remove the entire method body.

Do NOT delete Dashboard(), ExportAnalyticsResults(), SearchUsers(), or any of the new Build*SubModel methods from 12-01.

**Step 6 — CMPController.cs:**

Delete these actions:
1. `ReportsIndex()` — the entire action method
2. `ExportResults()` — the entire action method (already moved to CDPController as ExportAnalyticsResults in 12-01)
3. `SearchUsers()` — ONLY if the pre-grep confirms it is not used by any remaining CMP view. If another CMP view uses SearchUsers, leave it on CMPController.

Do NOT delete `UserAssessmentHistory()` — it is kept per Claude's discretion.

**Step 7 — Verify no orphaned references remain:**

After all changes, re-run the greps from Step 0. The only remaining hits should be:
- `ReportsIndex`: ZERO hits in .cshtml files, ZERO hits in .cs files (after action deletion)
- `DevDashboard`: ZERO hits in .cshtml files, ZERO hits in .cs files (after action + view deletion)
- `ExportResults`: ZERO hits in .cshtml files, ZERO hits in CMPController.cs (ExportAnalyticsResults on CDPController is fine)
- `DashboardViewModel`: ZERO hits (after file deletion in Task 2)
- `DevDashboardViewModel`: ZERO hits (after file deletion in Task 2)
  </action>
  <verify>
Run all five greps again after changes:
1. `grep -rn "ReportsIndex" --include="*.cshtml" --include="*.cs" .` — must return 0 results
2. `grep -rn "DevDashboard" --include="*.cshtml" --include="*.cs" .` — must return 0 results (after Task 2 file deletion)
3. `grep -rn "ExportResults[^A]" --include="*.cshtml" --include="*.cs" .` — must return 0 results (ExportAnalyticsResults is allowed)
4. _Layout.cshtml contains `asp-action="Dashboard"` with `asp-controller="CDP"` and NO role gate around it
5. _Layout.cshtml does NOT contain "DevDashboard" or "ReportsIndex"
6. UserAssessmentHistory.cshtml does NOT contain "ReportsIndex"
7. `dotnet build` passes with 0 errors
  </verify>
  <done>
All references to ReportsIndex, DevDashboard, ExportResults (old name), DashboardViewModel, and DevDashboardViewModel are removed from surviving files. _Layout.cshtml has a universal Dashboard nav link. UserAssessmentHistory has no ReportsIndex links. CMP/Index has updated card link.
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete standalone page files and superseded ViewModels</name>
  <files>
    Views/CDP/DevDashboard.cshtml
    Views/CMP/ReportsIndex.cshtml
    Models/DevDashboardViewModel.cs
    Models/DashboardViewModel.cs
  </files>
  <action>
Delete these files entirely using `git rm`:

1. `Views/CDP/DevDashboard.cshtml` — replaced by _ProtonProgressPartial in Dashboard
2. `Views/CMP/ReportsIndex.cshtml` — replaced by _AssessmentAnalyticsPartial in Dashboard
3. `Models/DevDashboardViewModel.cs` — replaced by ProtonProgressSubModel + CoacheeProgressRow in CDPDashboardViewModel.cs
4. `Models/DashboardViewModel.cs` — replaced by CDPDashboardViewModel.cs

Before deleting DashboardViewModel.cs, grep for its usage: `grep -rn "DashboardViewModel" --include="*.cs" --include="*.cshtml" .` — since Dashboard() was rewritten in 12-01 to use CDPDashboardViewModel, there should be zero remaining references. If any remain, fix them first.

Before deleting DevDashboardViewModel.cs, grep for its usage: `grep -rn "DevDashboardViewModel" --include="*.cs" --include="*.cshtml" .` — the DevDashboard() action was deleted in Task 1, so there should be zero remaining references. If any remain, fix them first.

Use `git rm` to ensure proper Git tracking:
```bash
git rm Views/CDP/DevDashboard.cshtml
git rm Views/CMP/ReportsIndex.cshtml
git rm Models/DevDashboardViewModel.cs
git rm Models/DashboardViewModel.cs
```

After deletion, run `dotnet build` to confirm no compilation errors from missing files/types.
  </action>
  <verify>
1. `ls Views/CDP/DevDashboard.cshtml` — file does not exist
2. `ls Views/CMP/ReportsIndex.cshtml` — file does not exist
3. `ls Models/DevDashboardViewModel.cs` — file does not exist
4. `ls Models/DashboardViewModel.cs` — file does not exist
5. `dotnet build` passes with 0 errors — no type references to deleted ViewModels
6. `git status` shows the 4 files as deleted
  </verify>
  <done>
All four standalone files are deleted. No compilation errors from missing types. Git tracks the deletions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify consolidated Dashboard end-to-end</name>
  <files>Views/CDP/Dashboard.cshtml</files>
  <action>
Human verifies the complete Dashboard consolidation end-to-end. All automated work from Tasks 1-2 (and Plans 12-01, 12-02) must be confirmed working by testing in the running application across all role scenarios. No additional code changes needed — this is a verification-only checkpoint.
  </action>
  <verify>
Run the application and test these scenarios:

1. **As Coachee:**
   - Dashboard nav link is visible in the nav bar
   - Click Dashboard — see Proton Progress tab with personal deliverable progress (stat cards + track info)
   - NO Assessment Analytics tab visible
   - No "Dev Dashboard" nav link anywhere

2. **As Coach/Spv:**
   - Dashboard nav link visible — click it
   - Proton Progress tab shows stat cards + flat coachee table (sorted by name) + Chart.js charts
   - Data scoped to unit (not all sections)
   - NO Assessment Analytics tab visible
   - No "Dev Dashboard" nav link; no "HC Reports" nav link

3. **As HC or Admin:**
   - Dashboard nav link visible — click it
   - Proton Progress tab shows all coachees (full scope)
   - Assessment Analytics tab visible — click it
   - See KPI cards, filter form, paginated table, Export to Excel button at top
   - Apply a filter — page reloads on Analytics tab with filtered results
   - Click Export to Excel — downloads .xlsx file
   - No "Dev Dashboard" nav link; no "HC Reports" nav link

4. **As Admin simulating Coachee (SelectedView = Coachee):**
   - Dashboard still shows BOTH tabs (Analytics tab gate ignores SelectedView)

5. **Dead routes:**
   - Navigate directly to /CDP/DevDashboard — should return 404 or error (action deleted)
   - Navigate directly to /CMP/ReportsIndex — should return 404 or error (action deleted)

6. **CMP Index page:**
   - As HC/Admin, visit CMP Index — the former "HC Reports" card now links to Dashboard (not 404)

7. **UserAssessmentHistory:**
   - If accessible from Analytics table drill-down, verify page loads
   - Verify no broken "Back to Reports" link (should be removed)
  </verify>
  <done>
All 7 verification scenarios pass. Dashboard consolidation is complete. Phase 12 done. v1.2 UX Consolidation milestone complete.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build` passes with 0 errors after all deletions
2. Zero grep hits for "ReportsIndex" in .cshtml/.cs files
3. Zero grep hits for "DevDashboard" in .cshtml/.cs files
4. Zero grep hits for "DashboardViewModel" (without CDP prefix) in .cshtml/.cs files
5. _Layout.cshtml has Dashboard link with no role gate
6. 4 files deleted (DevDashboard.cshtml, ReportsIndex.cshtml, DevDashboardViewModel.cs, DashboardViewModel.cs)
7. Human verification confirms all role scenarios work correctly
</verification>

<success_criteria>
- Both standalone pages are fully retired — no redirects, no routes, no files
- Dashboard nav link is visible to ALL roles including Coachees
- No 404s from orphaned links in any surviving view
- Application builds and all role scenarios verified by human
- Phase 12 complete — v1.2 UX Consolidation milestone is done
</success_criteria>

<output>
After completion, create `.planning/phases/12-dashboard-consolidation/12-03-SUMMARY.md`
</output>
