---
phase: 43-worker-polling
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - Views/CMP/StartExam.cshtml
autonomous: false

must_haves:
  truths:
    - "Worker on the exam page is automatically redirected to their Results page within 10–30 seconds of HC closing the session — without any manual page refresh"
    - "The poll interval is 10 seconds (not 30 seconds)"
  artifacts:
    - path: "Views/CMP/StartExam.cshtml"
      provides: "Tightened polling interval"
      contains: "setInterval(checkExamStatus, 10000)"
  key_links:
    - from: "Views/CMP/StartExam.cshtml (statusPollInterval)"
      to: "CheckExamStatus endpoint"
      via: "setInterval at 10s"
      pattern: "setInterval\\(checkExamStatus,\\s*10000\\)"
---

<objective>
Change the exam page polling interval from 30 seconds to 10 seconds so workers detect HC's early close within 10–20 seconds rather than up to 30–60 seconds.

Purpose: The polling loop already exists and works end-to-end (banner + redirect). The only change is tightening the interval from 30000ms to 10000ms. With the backend cache added in Plan 01 (5-second TTL), a 10-second poll interval means at most 2 polls per worker per cache TTL, still hitting cache most of the time.

Output: StartExam.cshtml line 708 reads `setInterval(checkExamStatus, 10000)` instead of `setInterval(checkExamStatus, 30000)`.
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@Views/CMP/StartExam.cshtml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tighten polling interval from 30s to 10s in StartExam.cshtml</name>
  <files>Views/CMP/StartExam.cshtml</files>
  <action>
    On line 708 of Views/CMP/StartExam.cshtml, change:
    ```javascript
    statusPollInterval = setInterval(checkExamStatus, 30000);
    ```
    to:
    ```javascript
    statusPollInterval = setInterval(checkExamStatus, 10000);
    ```

    Also update the comment on line 676 from:
    ```javascript
    // -------- Poll CheckExamStatus every 30s (detect early close by HC) --------
    ```
    to:
    ```javascript
    // -------- Poll CheckExamStatus every 10s (detect early close by HC) --------
    ```

    These are the only two changes in this file. Do not modify any other code in StartExam.cshtml.
  </action>
  <verify>
    Run `grep -n "setInterval" Views/CMP/StartExam.cshtml` — output must show `setInterval(checkExamStatus, 10000)` and must NOT show `setInterval(checkExamStatus, 30000)`.

    Run `dotnet build` — 0 errors (Razor views compile as part of the build).
  </verify>
  <done>
    StartExam.cshtml line 708 reads `setInterval(checkExamStatus, 10000)`. The comment on line 676 reads "every 10s". No `30000` remains in the polling setup. Build succeeds.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Checkpoint: End-to-end verification — worker auto-redirects within 10–30s of HC closing early</name>
  <files>none — human verification only</files>
  <action>No automated action. Human verifies the full Phase 43 polling flow works end-to-end.</action>
  <what-built>
    Full Phase 43 end-to-end: backend cache (Plan 01) + tightened polling interval (this plan). Workers on the exam page now poll every 10 seconds; CheckExamStatus returns cached results within a 5-second TTL; CloseEarly invalidates cache immediately.
  </what-built>
  <how-to-verify>
    1. Start the application with `dotnet run`.
    2. Log in as HC, open an assessment group in AssessmentMonitoringDetail that has at least one InProgress session.
    3. Open a second browser tab logged in as the worker assigned to that session, navigate to the StartExam page (session must be InProgress).
    4. Verify the exam page loads normally — worker sees questions, timer is running.
    5. Back in the HC tab: click "Tutup Lebih Awal" and confirm the early close.
    6. Watch the worker tab — within 10–30 seconds, the worker should see the yellow banner: "Ujian telah ditutup oleh administrator. Anda akan diarahkan ke halaman hasil..." and then be automatically redirected to their Results page (no manual refresh needed).
    7. Confirm the Results page loads correctly after redirect.

    If you cannot run a live two-user test, verify at minimum:
    - Browser DevTools (Network tab) on the StartExam page shows `/CMP/CheckExamStatus?sessionId=X` being called approximately every 10 seconds (not 30 seconds).
    - The application starts and the StartExam page loads without JavaScript errors in the console.
  </how-to-verify>
  <verify>Human confirms redirect occurs within 10–30s of CloseEarly being triggered.</verify>
  <done>Worker tab auto-redirects to Results page within 10–30 seconds of HC clicking "Tutup Lebih Awal".</done>
  <resume-signal>Type "approved" if the polling works end-to-end, or describe any issues observed.</resume-signal>
</task>

</tasks>

<verification>
1. `grep -n "10000" Views/CMP/StartExam.cshtml` — confirms 10s interval present
2. `grep -n "30000" Views/CMP/StartExam.cshtml` — must return zero results (or only unrelated occurrences not in the statusPollInterval line)
3. `dotnet build` — 0 errors
4. Human verification: worker tab auto-redirects within 10–30s after HC closes early
</verification>

<success_criteria>
- POLL-01: Exam page polls CheckExamStatus every 10 seconds (interval changed from 30000 to 10000)
- POLL-02: Worker is auto-redirected to Results page when session closure detected (existing redirect logic unchanged, confirmed working via human verification)
- No JavaScript errors on exam page load
- Application builds with 0 errors
</success_criteria>

<output>
After completion, create `.planning/phases/43-worker-polling/43-02-SUMMARY.md` using the summary template.
</output>
