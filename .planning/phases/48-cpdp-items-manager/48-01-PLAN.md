---
index: 1
wave: 1
title: "CpdpItems page: GET action, read-mode table, section dropdown, Admin/Index link"
depends_on: []
files_modified:
  - Controllers/AdminController.cs
  - Views/Admin/CpdpItems.cshtml
  - Views/Admin/Index.cshtml
autonomous: true
requirements:
  - MDAT-02
---

## Objective

Scaffold the `/Admin/CpdpItems` page so Admin can navigate to it from the Kelola Data hub, select a section via dropdown, and see a compact read-mode table of CpdpItem records filtered by section.

This is the read-only foundation. Plan 02 adds edit mode and write operations.

## Context

@Controllers/AdminController.cs — extend with CpdpItems GET action (pattern: KkjMatrix action)
@Views/Admin/Index.cshtml — update CPDP Items card link from `#` to `/Admin/CpdpItems`
@Models/KkjModels.cs — CpdpItem model: Id, No, NamaKompetensi, IndikatorPerilaku, DetailIndikator, Silabus, TargetDeliverable, Status, Section
@Views/Admin/KkjMatrix.cshtml — reference for page structure, breadcrumb, card layout, antiforgery token placement
@Views/CMP/Mapping.cshtml — reference for the read-mode table column structure (No, NamaKompetensi, IndikatorPerilaku are the first 3 columns)
@Data/ApplicationDbContext.cs — DbSet<CpdpItem> CpdpItems

## Tasks

<task id="48-01-T1" type="auto" wave="1">
  <title>Add CpdpItems GET action to AdminController</title>
  <files>
    - Controllers/AdminController.cs
  </files>
  <action>
Add a new GET action `CpdpItems()` to AdminController immediately after the `KkjMatrixDelete` action (at end of controller, before closing brace).

The action should:
1. Set `ViewData["Title"] = "KKJ-IDP Mapping Editor";`
2. Query all CpdpItems from `_context.CpdpItems` ordered by `c.No` then `c.Id`
3. Return `View(items)` with the full list (client-side filtering happens in the view)

```csharp
// GET /Admin/CpdpItems
public async Task<IActionResult> CpdpItems()
{
    ViewData["Title"] = "KKJ-IDP Mapping Editor";
    var items = await _context.CpdpItems
        .OrderBy(c => c.No)
        .ThenBy(c => c.Id)
        .ToListAsync();
    return View(items);
}
```

Do NOT add any other actions yet — write endpoints are in Plan 02.
  </action>
  <verify>
    <automated>dotnet build HcPortal.csproj --no-restore 2>&1 | tail -5</automated>
  </verify>
  <done>AdminController compiles without errors. GET /Admin/CpdpItems route is routable (confirmed by build success).</done>
</task>

<task id="48-01-T2" type="auto" wave="1">
  <title>Create Views/Admin/CpdpItems.cshtml — read-mode page with section dropdown</title>
  <files>
    - Views/Admin/CpdpItems.cshtml
  </files>
  <action>
Create `Views/Admin/CpdpItems.cshtml` as a new file. This is the read-mode view only (edit mode added in Plan 02).

**Model:** `@model List<HcPortal.Models.CpdpItem>`

**ViewData:** `ViewData["ContainerClass"] = "container-fluid px-4";` in the `@{}` block.

**Structure:**

1. **AntiForgeryToken** — place `@Html.AntiForgeryToken()` near the top (Plan 02 will use it for AJAX)

2. **Breadcrumb:**
```html
<nav aria-label="breadcrumb" class="mb-2">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/Admin">Kelola Data</a></li>
    <li class="breadcrumb-item active">KKJ-IDP Mapping Editor</li>
  </ol>
</nav>
```

3. **Header toolbar** — card header with title and Edit button (disabled/hidden in read mode, Plan 02 activates it):
```html
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">KKJ-IDP Mapping Editor (CPDP Items)</h5>
    <div id="readActions">
      <button id="btnEdit" class="btn btn-sm btn-primary"><i class="bi bi-pencil me-1"></i>Edit</button>
    </div>
    <div id="editActions" class="d-none gap-2 d-flex">
      <button id="btnSave" class="btn btn-sm btn-success"><i class="bi bi-check-lg me-1"></i>Simpan</button>
      <button id="btnCancel" class="btn btn-sm btn-secondary"><i class="bi bi-x-lg me-1"></i>Batal</button>
    </div>
  </div>
  <div class="card-body">
```

4. **Section filter dropdown** — placed inside card-body, above the table:
```html
<div class="mb-3 d-flex align-items-center gap-2">
  <label for="sectionFilter" class="form-label mb-0 fw-semibold">Filter Bagian:</label>
  <select id="sectionFilter" class="form-select form-select-sm" style="max-width:180px;">
    <option value="">Semua Bagian</option>
    <option value="RFCC">RFCC</option>
    <option value="GAST">GAST</option>
    <option value="NGP">NGP</option>
    <option value="DHT">DHT</option>
  </select>
  <span id="rowCount" class="text-muted small"></span>
</div>
<input type="hidden" id="selectedSection" value="" />
```

5. **Read-mode table** — `id="readTableWrapper"`, compact 3-column + Aksi:
   - Columns: No | Nama Kompetensi | Indikator Perilaku | Aksi
   - Each `<tr>` has `data-id="@item.Id"` and `data-section="@item.Section"`
   - The Aksi column has a delete button: `<button class="btn btn-sm btn-outline-danger delete-btn" data-id="@item.Id" data-name="@Html.AttributeEncode(item.NamaKompetensi)"><i class="bi bi-trash"></i></button>`
   - NamaKompetensi and IndikatorPerilaku cells can be truncated with `text-truncate` style if too long — keep max-width ~300px on those columns
   - Use class `table table-sm table-hover table-bordered`

6. **Placeholder divs for Plan 02 edit mode** (empty placeholders so Plan 02 can inject without modifying this view):
```html
<div id="editTableWrapper" class="d-none"></div>
```

7. **Toast notification** (for Plan 02 save confirmation — place now so Plan 02 can use it):
```html
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="saveToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body fw-semibold">Data berhasil disimpan.</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>
```

8. **JavaScript for section filter** — vanilla JS, place in `<script>` at bottom:
```javascript
var currentSection = '';

document.getElementById('sectionFilter').addEventListener('change', function(e) {
    currentSection = e.target.value;
    document.getElementById('selectedSection').value = currentSection;
    filterTables();
});

function filterTables() {
    var rows = document.querySelectorAll('#readTableWrapper tbody tr');
    var visible = 0;
    rows.forEach(function(row) {
        var rowSection = (row.dataset.section || '').toUpperCase();
        var sel = currentSection.toUpperCase();
        var show = (sel === '' || rowSection === sel);
        row.style.display = show ? '' : 'none';
        if (show) visible++;
    });
    document.getElementById('rowCount').textContent = rows.length > 0 ? visible + ' baris' : '';
}

// Initialize count on load
filterTables();
```

9. **Close card-body and card divs** properly.

**CSS — inline `<style>` block:**
```css
.table-sm td, .table-sm th { font-size: 0.85rem; padding: 0.4rem 0.5rem; vertical-align: middle; }
#readTableWrapper th, #readTableWrapper td:first-child { white-space: nowrap; }
#readTableWrapper td:nth-child(2) { max-width: 220px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
#readTableWrapper td:nth-child(3) { max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
```

**Serialize model to JS variable** at top of `@{}` block (Plan 02 needs it):
```csharp
var itemsJson = System.Text.Json.JsonSerializer.Serialize(Model,
    new System.Text.Json.JsonSerializerOptions { PropertyNamingPolicy = null });
```
Then in `<script>`: `var cpdpItems = @Html.Raw(itemsJson);`
  </action>
  <verify>
    <automated>dotnet build HcPortal.csproj --no-restore 2>&1 | tail -5</automated>
  </verify>
  <done>Build succeeds. Navigating to GET /Admin/CpdpItems shows the page with breadcrumb, section dropdown, and read-mode table populated with CpdpItem rows. Changing dropdown filters table rows by section. Row count updates.</done>
</task>

<task id="48-01-T3" type="auto" wave="1">
  <title>Update Admin/Index.cshtml — activate CPDP Items card link</title>
  <files>
    - Views/Admin/Index.cshtml
  </files>
  <action>
In `Views/Admin/Index.cshtml`, find the CPDP Items card (currently `<a href="#">`). Replace it so the card links to `/Admin/CpdpItems` and the "Segera" badge is removed (the feature is now live).

Find the block:
```html
    <div class="col-md-4">
        <a href="#" class="text-decoration-none">
            <div class="card shadow-sm h-100 border-0 opacity-75">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-2 mb-2">
                        <i class="bi bi-list-check fs-5 text-primary"></i>
                        <span class="fw-bold">CPDP Items</span>
                        <span class="badge bg-secondary ms-auto" style="font-size:0.6rem;">Segera</span>
                    </div>
                    <small class="text-muted">Kelola item CPDP (kompetensi-deliverable)</small>
                </div>
            </div>
        </a>
    </div>
```

Replace with:
```html
    <div class="col-md-4">
        <a href="@Url.Action("CpdpItems", "Admin")" class="text-decoration-none">
            <div class="card shadow-sm h-100 border-0">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-2 mb-2">
                        <i class="bi bi-list-check fs-5 text-primary"></i>
                        <span class="fw-bold">KKJ-IDP Mapping Editor</span>
                    </div>
                    <small class="text-muted">Kelola item CPDP (kompetensi-deliverable mapping)</small>
                </div>
            </div>
        </a>
    </div>
```

Note: Remove `opacity-75` from card div (active cards have full opacity). Remove "Segera" badge. Update display name to "KKJ-IDP Mapping Editor".
  </action>
  <verify>
    <automated>dotnet build HcPortal.csproj --no-restore 2>&1 | tail -5</automated>
  </verify>
  <done>Build succeeds. Admin/Index shows "KKJ-IDP Mapping Editor" card (no Segera badge, full opacity) with link to /Admin/CpdpItems. Clicking it navigates to the CpdpItems page.</done>
</task>

## Verification

**Manual smoke test after all 3 tasks:**
1. Run app, navigate to `/Admin` (as Admin role)
2. Confirm "KKJ-IDP Mapping Editor" card is active (no Segera badge, no opacity-75)
3. Click card — lands on `/Admin/CpdpItems`
4. Page shows breadcrumb "Kelola Data > KKJ-IDP Mapping Editor"
5. Section dropdown shows RFCC, GAST, NGP, DHT options
6. Table shows all CpdpItem rows with No, Nama Kompetensi, Indikator Perilaku, Aksi columns
7. Selecting "RFCC" from dropdown hides non-RFCC rows
8. Row count badge updates correctly
9. Edit button visible (does nothing yet — Plan 02 wires it)

## must_haves

- [ ] GET /Admin/CpdpItems returns 200 and shows all CpdpItem rows
- [ ] Section dropdown filters rows client-side (no page reload)
- [ ] Admin/Index card for CPDP Items links to /Admin/CpdpItems (not #)
- [ ] Page has breadcrumb back to /Admin
- [ ] AntiForgeryToken is rendered in the page (for Plan 02 AJAX)
- [ ] cpdpItems JS variable is initialized with serialized model (for Plan 02 JS)
