---
phase: 65-actions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Models/ProtonModels.cs
  - Models/CoachingSession.cs
  - Models/TrackingModels.cs
  - Controllers/CDPController.cs
  - Views/CDP/ProtonProgress.cshtml
autonomous: true
requirements: [ACTN-01, ACTN-02]
must_haves:
  truths:
    - "SrSpv clicking Tinjau on a Submitted deliverable opens a modal, choosing Approve saves SrSpvApprovalStatus=Approved to database"
    - "SectionHead clicking Tinjau on a Submitted deliverable opens a modal, choosing Reject with reason saves ShApprovalStatus=Rejected and RejectionReason to database"
    - "HC clicking Review on a Submitted deliverable shows confirm dialog and saves HCApprovalStatus=Reviewed to database"
    - "Each approval column (SrSpv, SH, HC) independently reflects only that role's action — SrSpv approving does not affect SH column"
    - "Approval badge shows tooltip with approver name and date on hover"
    - "After AJAX approve/reject, row updates in-place with toast notification — no full page reload"
    - "All deliverables start as Pending (Locked status removed from system)"
  artifacts:
    - path: "Models/ProtonModels.cs"
      provides: "Per-role approval fields on ProtonDeliverableProgress"
      contains: "SrSpvApprovalStatus"
    - path: "Models/TrackingModels.cs"
      provides: "Extended TrackingItem with per-role approval data and tooltip fields"
      contains: "SrSpvApproverName"
    - path: "Controllers/CDPController.cs"
      provides: "ApproveFromProgress, RejectFromProgress, HCReviewFromProgress AJAX endpoints"
      contains: "ApproveFromProgress"
    - path: "Views/CDP/ProtonProgress.cshtml"
      provides: "Tinjau modal, HC confirm dialog, toast container, action buttons per role"
      contains: "tinjaModal"
  key_links:
    - from: "Views/CDP/ProtonProgress.cshtml"
      to: "CDPController.ApproveFromProgress"
      via: "fetch() AJAX POST"
      pattern: "fetch.*ApproveFromProgress"
    - from: "Views/CDP/ProtonProgress.cshtml"
      to: "CDPController.RejectFromProgress"
      via: "fetch() AJAX POST"
      pattern: "fetch.*RejectFromProgress"
    - from: "CDPController.ApproveFromProgress"
      to: "ProtonDeliverableProgress.SrSpvApprovalStatus"
      via: "EF Core update"
      pattern: "SrSpvApprovalStatus.*Approved"
---

<objective>
Add per-role independent approval schema, migrate Locked->Pending status, create AJAX Approve/Reject/HCReview endpoints, and update ProtonProgress table with Tinjau buttons, approval modal, HC confirm dialog, badges with tooltips, and toast notifications.

Purpose: Wires ACTN-01 (Approve) and ACTN-02 (Reject) end-to-end — from button click to database persistence and in-place UI update.
Output: Three new AJAX endpoints in CDPController, EF migration, updated ProtonProgress view with modal and action buttons.
</objective>

<execution_context>
@C:/Users/Administrator/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Administrator/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/65-actions/65-CONTEXT.md
@.planning/phases/65-actions/65-RESEARCH.md
@.planning/phases/64-functional-filters/64-01-SUMMARY.md
@.planning/phases/64-functional-filters/64-02-SUMMARY.md

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->

From Models/ProtonModels.cs (current ProtonDeliverableProgress — lines 81-114):
```csharp
public class ProtonDeliverableProgress
{
    public int Id { get; set; }
    public string CoacheeId { get; set; } = "";
    public int ProtonDeliverableId { get; set; }
    public ProtonDeliverable? ProtonDeliverable { get; set; }
    public string Status { get; set; } = "Locked"; // "Locked", "Active", "Submitted", "Approved", "Rejected"
    public string? EvidencePath { get; set; }
    public string? EvidenceFileName { get; set; }
    public DateTime? SubmittedAt { get; set; }
    public DateTime? ApprovedAt { get; set; }
    public DateTime? RejectedAt { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public string? RejectionReason { get; set; }
    public string? ApprovedById { get; set; }
    public string HCApprovalStatus { get; set; } = "Pending";
    public DateTime? HCReviewedAt { get; set; }
    public string? HCReviewedById { get; set; }
}
```

From Models/TrackingModels.cs (current):
```csharp
public class TrackingItem
{
    public int Id { get; set; }
    public string Kompetensi { get; set; } = "";
    public string Periode { get; set; } = "";
    public string SubKompetensi { get; set; } = "";
    public string Deliverable { get; set; } = "";
    public string EvidenceStatus { get; set; } = "";
    public string FullEvidencePath { get; set; } = "";
    public string ApprovalSrSpv { get; set; } = "Not Started";
    public string ApprovalSectionHead { get; set; } = "Not Started";
    public string ApprovalHC { get; set; } = "Not Started";
    public string SupervisorComments { get; set; } = "";
    public string CoacheeId { get; set; } = "";
    public string CoacheeName { get; set; } = "";
}
```

From Models/CoachingSession.cs (current):
```csharp
public class CoachingSession
{
    public int Id { get; set; }
    public string CoachId { get; set; } = "";
    public string CoacheeId { get; set; } = "";
    public DateTime Date { get; set; }
    public string Kompetensi { get; set; } = "";
    public string SubKompetensi { get; set; } = "";
    public string Deliverable { get; set; } = "";
    public string CoacheeCompetencies { get; set; } = "";
    public string CatatanCoach { get; set; } = "";
    public string Kesimpulan { get; set; } = "";
    public string Result { get; set; } = "";
    public string Status { get; set; } = "Draft";
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime? UpdatedAt { get; set; }
    public ICollection<ActionItem> ActionItems { get; set; } = new List<ActionItem>();
}
```

CDPController existing action signatures (lines ~673-1400):
- `public async Task<IActionResult> AssignTrack(string coacheeId, int protonTrackId)` — creates ProtonDeliverableProgress records with Status="Locked"/"Active"
- `public async Task<IActionResult> ApproveDeliverable(int progressId)` — existing single-approver flow
- `public async Task<IActionResult> RejectDeliverable(int progressId, string rejectionReason)` — existing reject
- `public async Task<IActionResult> UploadEvidence(int progressId, IFormFile? evidenceFile)` — existing upload
- `public async Task<IActionResult> ProtonProgress(...)` — GET action with 5 filter params, returns View with List<TrackingItem>

From Views/CDP/ProtonProgress.cshtml (Phase 64 output, 502 lines):
- GET form filter bar with Bagian/Unit/Track/Tahun/Coachee dropdowns
- Server-side Razor rowspan table with 8 columns: Kompetensi | Sub Kompetensi | Deliverable | Evidence | Approval Sr. Spv | Approval Section Head | Approval HC | Aksi
- @functions block with GetApprovalBadge() helper
- Client-side search with 300ms debounce
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Schema migration — per-role approval fields + Locked-to-Pending data fix + CoachingSession FK</name>
  <files>
    Models/ProtonModels.cs
    Models/CoachingSession.cs
    Models/TrackingModels.cs
    Controllers/CDPController.cs
  </files>
  <action>
**1. Add per-role approval fields to ProtonDeliverableProgress** (Models/ProtonModels.cs):

After the existing `HCReviewedById` property, add a new section:

```csharp
// ===== Phase 65: Independent Per-Role Approval =====
/// <summary>SrSpv independent approval. Values: "Pending", "Approved", "Rejected"</summary>
public string SrSpvApprovalStatus { get; set; } = "Pending";
/// <summary>SrSpv approver user ID. No FK — matches pattern.</summary>
public string? SrSpvApprovedById { get; set; }
/// <summary>When SrSpv approved/rejected.</summary>
public DateTime? SrSpvApprovedAt { get; set; }

/// <summary>SectionHead independent approval. Values: "Pending", "Approved", "Rejected"</summary>
public string ShApprovalStatus { get; set; } = "Pending";
/// <summary>SectionHead approver user ID. No FK — matches pattern.</summary>
public string? ShApprovedById { get; set; }
/// <summary>When SectionHead approved/rejected.</summary>
public DateTime? ShApprovedAt { get; set; }
```

Also change the Status default from `"Locked"` to `"Pending"` and update the XML comment:
```csharp
/// <summary>Values: "Pending", "Submitted", "Approved", "Rejected"</summary>
public string Status { get; set; } = "Pending";
```

**2. Add ProtonDeliverableProgressId to CoachingSession** (Models/CoachingSession.cs):

After the `UpdatedAt` property (before ActionItems), add:
```csharp
/// <summary>Links coaching session to a specific deliverable progress record. No FK constraint — matches project pattern.</summary>
public int? ProtonDeliverableProgressId { get; set; }
```

**3. Extend TrackingItem** (Models/TrackingModels.cs):

Add these properties to support tooltip data, per-role status, and evidence link:
```csharp
public string SrSpvApproverName { get; set; } = "";
public string SrSpvApprovedAt { get; set; } = "";
public string ShApproverName { get; set; } = "";
public string ShApprovedAt { get; set; } = "";
public string HcReviewerName { get; set; } = "";
public string HcReviewedAt { get; set; } = "";
public string Status { get; set; } = "Pending"; // Overall deliverable status for button enable logic
```

**4. Run EF migration** with data fix:

```bash
cd C:/Users/Administrator/Desktop/PortalHC_KPB/.claude/worktrees/terminal-a
dotnet ef migrations add AddPerRoleApprovalAndCoachingLink --configuration Release
```

After the migration is scaffolded, edit the `Up()` method to add a data migration:
- After all `AddColumn` calls, add:
```csharp
migrationBuilder.Sql("UPDATE [ProtonDeliverableProgresses] SET [Status] = 'Pending' WHERE [Status] = 'Locked'");
migrationBuilder.Sql("UPDATE [ProtonDeliverableProgresses] SET [Status] = 'Pending' WHERE [Status] = 'Active'");
migrationBuilder.Sql("UPDATE [ProtonDeliverableProgresses] SET [SrSpvApprovalStatus] = 'Approved', [SrSpvApprovedById] = [ApprovedById], [SrSpvApprovedAt] = [ApprovedAt] WHERE [Status] = 'Approved' AND [ApprovedById] IS NOT NULL");
```
The third SQL backfills existing approved records so SrSpv column isn't blank for already-approved items.

Then apply:
```bash
dotnet ef database update --configuration Release
```

**5. Update AssignTrack** in CDPController.cs:

Find the `AssignTrack` action (line ~673). In the loop that creates `ProtonDeliverableProgress` records:
- Change: first record gets `Status = "Active"`, rest get `Status = "Locked"`
- To: ALL records get `Status = "Pending"` (no more Locked/Active distinction)

Also find the `ApproveDeliverable` action (line ~866) — in the section that sets the next deliverable to "Active", remove or comment out that logic (no more sequential unlock — CONTEXT.md says "Remove Locked status entirely").

**6. Update ProtonProgress action mapping** in CDPController.cs:

In the `ProtonProgress` GET action (line ~1413), find the TrackingItem mapping Select() block. Update:
- `ApprovalSrSpv` mapping: change from `Status == "Approved" ? "Approved" : ...` to `p.SrSpvApprovalStatus`
- `ApprovalSectionHead` mapping: change to `p.ShApprovalStatus`
- `ApprovalHC` mapping: change to use `p.HCApprovalStatus == "Reviewed" ? "Reviewed" : "Pending"`
- Add new fields: `SrSpvApproverName`, `SrSpvApprovedAt`, `ShApproverName`, `ShApprovedAt`, `HcReviewerName`, `HcReviewedAt`, `Status = p.Status`
- For approver names, pre-load a user dictionary before the Select:
  ```csharp
  var approverIds = deliverableProgresses
      .Where(p => p.SrSpvApprovedById != null || p.ShApprovedById != null || p.HCReviewedById != null)
      .SelectMany(p => new[] { p.SrSpvApprovedById, p.ShApprovedById, p.HCReviewedById })
      .Where(id => id != null)
      .Distinct()
      .ToList();
  var approverNames = await _context.Users
      .Where(u => approverIds.Contains(u.Id))
      .ToDictionaryAsync(u => u.Id, u => u.FullName ?? u.UserName ?? u.Id);
  ```
- In the Select: `SrSpvApproverName = p.SrSpvApprovedById != null && approverNames.ContainsKey(p.SrSpvApprovedById) ? approverNames[p.SrSpvApprovedById] : ""`

**7. Update summary stats** in ProtonProgress action:
- `pendingActions`: count where `Status == "Pending" || Status == "Rejected"` (coach needs to act)
- `pendingApprovals`: count where `Status == "Submitted"` — but make this **role-aware** via ViewBag:
  - For SrSpv: count where `Status == "Submitted" && SrSpvApprovalStatus == "Pending"`
  - For SH: count where `Status == "Submitted" && ShApprovalStatus == "Pending"`
  - For HC: count where `Status == "Submitted" && HCApprovalStatus == "Pending"`
  - For Coach/Coachee: total Submitted count
- `progressPercent`: Pending=0%, Submitted=50%, Approved=100%, Rejected=0% (per CONTEXT.md)

**Important:** The `approverIds` lookup must happen AFTER `ToListAsync()` materializes the data, since EF cannot translate dictionary lookups. Sequence: query -> ToListAsync -> compute approverIds from in-memory list -> load approverNames -> map to TrackingItem.
  </action>
  <verify>
    <automated>cd C:/Users/Administrator/Desktop/PortalHC_KPB/.claude/worktrees/terminal-a && dotnet build --configuration Release 2>&1 | tail -5</automated>
  </verify>
  <done>
    - ProtonDeliverableProgress has SrSpvApprovalStatus, SrSpvApprovedById, SrSpvApprovedAt, ShApprovalStatus, ShApprovedById, ShApprovedAt fields
    - CoachingSession has ProtonDeliverableProgressId nullable int
    - TrackingItem has SrSpvApproverName, SrSpvApprovedAt, ShApproverName, ShApprovedAt, HcReviewerName, HcReviewedAt, Status
    - Migration applied: Locked/Active records converted to Pending
    - AssignTrack creates all records with Status="Pending"
    - ApproveDeliverable no longer unlocks next deliverable
    - ProtonProgress mapping uses per-role fields
    - Build succeeds with 0 errors
  </done>
</task>

<task type="auto">
  <name>Task 2: AJAX endpoints (ApproveFromProgress, RejectFromProgress, HCReviewFromProgress) + view modal + toast</name>
  <files>
    Controllers/CDPController.cs
    Views/CDP/ProtonProgress.cshtml
  </files>
  <action>
**1. Add ApproveFromProgress endpoint** to CDPController.cs (after existing ProtonProgress action):

```csharp
[HttpPost]
[ValidateAntiForgeryToken]
public async Task<IActionResult> ApproveFromProgress(int progressId, string? comment)
```
- Get current user, determine role (SrSpv=Level 4 with SrSupervisor role, SH=Level 4 with SectionHead role, or check `UserRoles` constants)
- Validate: only SrSpv or SH can call this (HC uses HCReview endpoint)
- Load `ProtonDeliverableProgress` by Id
- Validate: `Status == "Submitted"` — only Submitted can be approved
- Validate: coachee's Section matches approver's Section (cross-section not allowed)
- Set per-role fields:
  - If SrSpv: `SrSpvApprovalStatus = "Approved"`, `SrSpvApprovedById = user.Id`, `SrSpvApprovedAt = DateTime.UtcNow`
  - If SH: `ShApprovalStatus = "Approved"`, `ShApprovedById = user.Id`, `ShApprovedAt = DateTime.UtcNow`
- Set overall: `Status = "Approved"`, `ApprovedAt = DateTime.UtcNow`, `ApprovedById = user.Id`
- If comment provided, save to a general comment field (or log)
- `SaveChangesAsync()`
- Return JSON: `{ success: true, message: "Deliverable berhasil disetujui", newStatus, approverName, approvedAt }`

**2. Add RejectFromProgress endpoint:**

```csharp
[HttpPost]
[ValidateAntiForgeryToken]
public async Task<IActionResult> RejectFromProgress(int progressId, string rejectionReason)
```
- Same role validation as Approve (SrSpv or SH only)
- Validate: `rejectionReason` is not empty (required for Reject per CONTEXT.md)
- Validate: `Status == "Submitted"`
- Set per-role fields:
  - If SrSpv: `SrSpvApprovalStatus = "Rejected"`, `SrSpvApprovedById = user.Id`, `SrSpvApprovedAt = DateTime.UtcNow`
  - If SH: `ShApprovalStatus = "Rejected"`, `ShApprovedById = user.Id`, `ShApprovedAt = DateTime.UtcNow`
- **Overall Status rule:** If ANY role rejects, overall `Status = "Rejected"` (rejection takes precedence per RESEARCH open question #1)
- Set `RejectionReason = rejectionReason`, `RejectedAt = DateTime.UtcNow`
- `SaveChangesAsync()`
- Return JSON: `{ success: true, message: "Deliverable ditolak", newStatus, approverName, approvedAt }`

**3. Add HCReviewFromProgress endpoint:**

```csharp
[HttpPost]
[ValidateAntiForgeryToken]
public async Task<IActionResult> HCReviewFromProgress(int progressId)
```
- Validate: user is HC or Admin (Level 1-2)
- Load progress record
- Set `HCApprovalStatus = "Reviewed"`, `HCReviewedAt = DateTime.UtcNow`, `HCReviewedById = user.Id`
- `SaveChangesAsync()`
- Return JSON: `{ success: true, message: "Deliverable telah direview", reviewerName, reviewedAt }`

**4. Update ProtonProgress.cshtml table columns** (restructure from Phase 64):

Replace the current 8-column table structure with the CONTEXT.md column layout:
**Columns: Kompetensi | Sub-Kompetensi | Deliverable | Evidence | Approval Sr.Spv | Approval SH | Approval HC | Detail**

For each deliverable row in the table body:
- **Evidence column:**
  - If user is Coach (Level 5) AND (Status == "Pending" || Status == "Rejected"): show `<button class="btn btn-sm btn-primary" ...>Submit Evidence</button>` — this button will be wired in Plan 02
  - Otherwise: show badge "Sudah Upload" (green) if EvidenceStatus == "Uploaded", or "Belum Upload" (gray) if Pending
- **Approval SrSpv column:**
  - Show badge from `item.ApprovalSrSpv` using GetApprovalBadge() helper
  - If badge is "Approved" or "Rejected": add `title="@item.SrSpvApproverName — @item.SrSpvApprovedAt"` for tooltip
  - If user has SrSpv role AND `item.Status == "Submitted"` AND `item.ApprovalSrSpv == "Pending"`: show `<button class="btn btn-sm btn-outline-primary btnTinjau" data-bs-toggle="modal" data-bs-target="#tinjaModal" data-progress-id="@item.Id" data-deliverable="@item.Deliverable" data-kompetensi="@item.Kompetensi" data-sub-kompetensi="@item.SubKompetensi" data-evidence-url="@item.FullEvidencePath" data-role="srspv">Tinjau</button>`
- **Approval SH column:** Same pattern but with SH role check and `data-role="sh"`
- **Approval HC column:**
  - Show badge from `item.ApprovalHC` with tooltip
  - If user is HC/Admin AND `item.Status == "Submitted"` AND `item.ApprovalHC == "Pending"`: show `<button class="btn btn-sm btn-outline-success btnHcReview" data-progress-id="@item.Id">Review</button>`
- **Detail column:** `<a asp-action="Deliverable" asp-route-id="@item.Id" class="btn btn-sm btn-outline-secondary">Lihat Detail</a>`

**5. Add Tinjau Modal** (shared modal for SrSpv/SH Approve/Reject):

Place before `@section Scripts`. One modal for all rows — JS populates on show:
```html
<div class="modal fade" id="tinjaModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Tinjau Deliverable</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="modalProgressId" />
        <input type="hidden" id="modalRole" />
        <p><strong>Kompetensi:</strong> <span id="modalKompetensi"></span></p>
        <p><strong>Sub-Kompetensi:</strong> <span id="modalSubKompetensi"></span></p>
        <p><strong>Deliverable:</strong> <span id="modalDeliverableName"></span></p>
        <p><strong>Evidence:</strong> <a id="modalEvidenceLink" href="#" target="_blank">Lihat Evidence</a></p>
        <div class="mb-3">
          <label class="form-label">Aksi</label>
          <select class="form-select" id="modalAction">
            <option value="">-- Pilih Aksi --</option>
            <option value="approve">Approve</option>
            <option value="reject">Reject</option>
          </select>
        </div>
        <div class="mb-3 d-none" id="commentGroup">
          <label class="form-label">Komentar <span id="commentRequired" class="text-danger d-none">*</span></label>
          <textarea class="form-control" id="modalComment" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-primary" id="btnSubmitTinja" disabled>Submit</button>
      </div>
    </div>
  </div>
</div>
```

**6. Add Toast container** to the view (place after the modal, before @section Scripts):

```html
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index:1100">
    <div id="actionToast" class="toast align-items-center border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body" id="actionToastBody"></div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>
```

**7. Add @section Scripts** JavaScript:

Add `@Html.AntiForgeryToken()` form at top of scripts section.

JS functions needed:
- `showToast(message, type)` — shows Bootstrap toast with type class (success/danger)
- Modal `show.bs.modal` event listener — populates fields from `data-*` attributes
- `modalAction` change handler — show/hide comment field, make comment required for Reject, enable/disable submit button
- `btnSubmitTinja` click handler:
  - Read progressId, action, comment, role from modal
  - Determine URL: action == "approve" ? "/CDP/ApproveFromProgress" : "/CDP/RejectFromProgress"
  - fetch() POST with AntiForgery token
  - On success: dismiss modal, show toast, update badge in the row's approval cell using `data-progress-id` selector, update the tooltip
  - On failure: show error toast
- `btnHcReview` click handler (for each HC Review button):
  - `confirm("Tandai sebagai sudah direview?")` — if confirmed, fetch POST to `/CDP/HCReviewFromProgress`
  - On success: replace button with "Reviewed" badge, show toast

**8. Update GetApprovalBadge** helper in `@functions` block:

Update badge mapping to match new status flow (CONTEXT.md):
- "Pending" → `<span class="badge bg-secondary">Pending</span>`
- "Submitted" → (not used in approval columns — approval columns show "Pending" when deliverable is Submitted)
- "Approved" → `<span class="badge bg-success">Approved</span>`
- "Rejected" → `<span class="badge bg-danger">Rejected</span>`
- "Reviewed" → `<span class="badge bg-success">Reviewed</span>` (HC column)
- "Not Started" → `<span class="badge bg-light text-dark">-</span>`

Add a new helper `GetStatusBadge(string status)` for the overall deliverable status:
- "Pending" → gray
- "Submitted" → blue (`bg-primary`)
- "Approved" → green
- "Rejected" → red

**Role detection in Razor:** Use `ViewBag.UserLevel` (already set by CDPController) and `ViewBag.UserRole` (add to controller if not already present). Set `ViewBag.UserRole = userRole` in ProtonProgress action alongside existing ViewBag assignments.
  </action>
  <verify>
    <automated>cd C:/Users/Administrator/Desktop/PortalHC_KPB/.claude/worktrees/terminal-a && dotnet build --configuration Release 2>&1 | tail -5</automated>
  </verify>
  <done>
    - ApproveFromProgress POST endpoint sets SrSpvApprovalStatus or ShApprovalStatus to "Approved" and returns JSON
    - RejectFromProgress POST endpoint sets per-role status to "Rejected" with RejectionReason and returns JSON
    - HCReviewFromProgress POST endpoint sets HCApprovalStatus to "Reviewed" and returns JSON
    - ProtonProgress.cshtml has Tinjau modal with Action dropdown + Comment field
    - Tinjau buttons appear per-role (SrSpv in SrSpv column, SH in SH column) only when Status==Submitted
    - HC Review button shows in HC column with confirm dialog
    - Toast notification appears after AJAX success/failure
    - Approval badges show tooltip with approver name and date on hover
    - Detail column links to Deliverable page
    - Build succeeds with 0 errors
  </done>
</task>

</tasks>

<verification>
1. `dotnet build --configuration Release` — 0 errors
2. Migration exists in Migrations/ directory with AddPerRoleApproval naming
3. ProtonDeliverableProgress has 6 new fields (SrSpv* and Sh* triplets)
4. CoachingSession has ProtonDeliverableProgressId
5. TrackingItem has tooltip fields (SrSpvApproverName, SrSpvApprovedAt, etc.)
6. CDPController has ApproveFromProgress, RejectFromProgress, HCReviewFromProgress actions
7. ProtonProgress.cshtml has tinjaModal, actionToast, btnTinjau, btnHcReview elements
8. AssignTrack no longer creates "Locked"/"Active" statuses
9. ProtonProgress action maps SrSpvApprovalStatus and ShApprovalStatus to TrackingItem
</verification>

<success_criteria>
- SrSpv/SH clicking Tinjau on a Submitted deliverable → modal → Approve/Reject → database updated → row badge updates in-place with toast
- HC clicking Review → confirm → database updated → badge updates
- Each approval column independently reflects only that role's action
- Badges show tooltip with approver name and date
- All new records start as Pending (no more Locked)
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/65-actions/65-01-SUMMARY.md`
</output>
