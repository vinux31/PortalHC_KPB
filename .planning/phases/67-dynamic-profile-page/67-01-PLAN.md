---
phase: 67-dynamic-profile-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Views/Account/Profile.cshtml
autonomous: true
requirements:
  - PROF-01
  - PROF-02
  - PROF-03

must_haves:
  truths:
    - "Profile page displays real user data (Nama, NIP, Email, Phone, Directorate, Section, Unit, Position, Role) from @Model — no hardcoded placeholders"
    - "Null or empty fields display em dash (—) styled text-muted, not blank space or error"
    - "Avatar initials circle matches _Layout.cshtml navbar initials algorithm exactly"
  artifacts:
    - path: "Views/Account/Profile.cshtml"
      provides: "Dynamic profile page with @model ApplicationUser binding"
      contains: "@model HcPortal.Models.ApplicationUser"
  key_links:
    - from: "Views/Account/Profile.cshtml"
      to: "Controllers/AccountController.cs Profile()"
      via: "@model ApplicationUser — controller passes return View(user)"
      pattern: "@model HcPortal\\.Models\\.ApplicationUser"
    - from: "Views/Account/Profile.cshtml"
      to: "ViewBag.UserRole"
      via: "ViewBag cast in @{ } block"
      pattern: "ViewBag\\.UserRole as string"
---

<objective>
Rewrite Profile.cshtml to display real user data from @Model instead of hardcoded placeholders.

Purpose: Profile page currently shows fake data ("Budi Santoso", "759921", etc.) — users see someone else's information regardless of who is logged in. This phase replaces all hardcoded values with @Model bindings to show the authenticated user's real data.

Output: Rewritten Views/Account/Profile.cshtml with dynamic data binding, null-safe em-dash fallback, and avatar initials matching the navbar.
</objective>

<execution_context>
@C:/Users/Administrator/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Administrator/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/67-dynamic-profile-page/67-CONTEXT.md
@.planning/phases/67-dynamic-profile-page/67-RESEARCH.md

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->

From Controllers/AccountController.cs — Profile() action (lines 81-98):
```csharp
public async Task<IActionResult> Profile()
{
    if (User.Identity?.IsAuthenticated != true)
        return RedirectToAction("Login");

    var user = await _userManager.GetUserAsync(User);
    if (user == null)
        return RedirectToAction("Login");

    var roles = await _userManager.GetRolesAsync(user);
    ViewBag.UserRole = roles.FirstOrDefault() ?? "No Role";

    return View(user); // <-- passes ApplicationUser as @Model
}
```

From Models/ApplicationUser.cs — field inventory:
```csharp
public class ApplicationUser : IdentityUser
{
    public string FullName { get; set; } = string.Empty;  // Never null, may be ""
    public string? NIP { get; set; }
    public string? Position { get; set; }
    public string? Section { get; set; }
    public string? Unit { get; set; }
    public string? Directorate { get; set; }
    public DateTime? JoinDate { get; set; }  // NOT displayed per CONTEXT
    // Inherited from IdentityUser:
    //   public string? Email { get; set; }
    //   public string? PhoneNumber { get; set; }
}
```

From Views/Shared/_Layout.cshtml — initials algorithm (lines 8-12):
```csharp
var fullName = currentUser?.FullName ?? "";
var nameParts = fullName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
var initials = nameParts.Length >= 2
    ? $"{nameParts[0][0]}{nameParts[1][0]}".ToUpper()
    : (fullName.Length >= 2 ? fullName.Substring(0, 2).ToUpper() : "?");
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite Profile.cshtml with @Model binding and two-section layout</name>
  <files>Views/Account/Profile.cshtml</files>
  <action>
Completely rewrite Views/Account/Profile.cshtml. The controller already passes ApplicationUser as the view model and sets ViewBag.UserRole — no controller changes needed.

**Line 1:** Add `@model HcPortal.Models.ApplicationUser` directive.

**@{ } block** — compute these variables:
- `ViewData["Title"] = "Profil Saya";`
- `var userRole = ViewBag.UserRole as string ?? "—";` (safe cast for role)
- Initials algorithm — MUST replicate _Layout.cshtml exactly:
  ```csharp
  var fullName = string.IsNullOrEmpty(Model.FullName) ? "" : Model.FullName;
  var nameParts = fullName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
  var initials = nameParts.Length >= 2
      ? $"{nameParts[0][0]}{nameParts[1][0]}".ToUpper()
      : (fullName.Length >= 2 ? fullName.Substring(0, 2).ToUpper() : "?");
  ```

**Layout structure** (per CONTEXT locked decisions — NO cards, flat label-value rows):

1. **Profile header** — flex container with:
   - Large avatar circle (bg-primary text-white rounded-circle, ~80-100px, font-size ~2rem) showing `@initials`
   - Name: `@Model.FullName` as h3/h4 fw-bold
   - Subtitle: Position (null-safe em dash if empty)
   - NO "Active Employee" badge (removed per CONTEXT)
   - Bottom border divider

2. **Section: Identitas** — uppercase small bold muted heading, then label-value rows:
   - Nama Lengkap → `Model.FullName`
   - NIP → `Model.NIP`
   - Email → `Model.Email`
   - Telepon → `Model.PhoneNumber` (inherited from IdentityUser — NOT on ApplicationUser directly)

3. **Divider** — `<hr class="my-3">` or `<hr class="my-4">`

4. **Section: Organisasi** — same heading style, then label-value rows:
   - Direktorat → `Model.Directorate`
   - Bagian → `Model.Section`
   - Unit → `Model.Unit`
   - Jabatan → `Model.Position`
   - Role → `userRole` variable (from ViewBag.UserRole cast)

**Each label-value row** uses Bootstrap grid:
```razor
<div class="row mb-2 py-1">
    <div class="col-sm-4 text-muted small fw-medium">{Label}</div>
    <div class="col-sm-8">
        @if (!string.IsNullOrEmpty(Model.PropertyName)) { @Model.PropertyName }
        else { <span class="text-muted">—</span> }
    </div>
</div>
```

**Critical null-safe handling (PROF-02):**
- Use `string.IsNullOrEmpty()` for ALL fields — FullName defaults to `string.Empty` (never null but may be empty), so `??` alone will NOT work for FullName.
- Em dash "—" displayed inside `<span class="text-muted">` to visually distinguish from real data.
- Sections are always shown even if all fields in that section are null.

**Role display special case:** Use the `userRole` variable. If it equals "No Role", treat it as empty and show em dash. Pattern: `@if (!string.IsNullOrEmpty(userRole) && userRole != "No Role") { @userRole } else { <span class="text-muted">—</span> }`.

**Bottom action** — Keep the "Edit Profile" link to Settings page (existing functionality):
```razor
<div class="d-flex justify-content-end mt-4">
    <a asp-controller="Account" asp-action="Settings" class="btn btn-outline-secondary">
        <i class="bi bi-gear me-1"></i> Edit Profile
    </a>
</div>
```

**Fields NOT included (per CONTEXT):**
- JoinDate — skipped
- Location — no backing field in ApplicationUser
- "Active Employee" badge — removed

**Style notes (Claude's discretion from CONTEXT):**
- Professional corporate HRIS feel — clean, not flashy
- No cards — use a simple container (col-md-8 centered is fine)
- Wrap content in a container div with some padding, no card borders
  </action>
  <verify>
    <automated>cd "C:/Users/Administrator/Desktop/PortalHC_KPB" && grep -c "@model HcPortal.Models.ApplicationUser" Views/Account/Profile.cshtml && grep -c "Model.FullName" Views/Account/Profile.cshtml && grep -c "Model.NIP" Views/Account/Profile.cshtml && grep -c "Model.Email" Views/Account/Profile.cshtml && grep -c "Model.PhoneNumber" Views/Account/Profile.cshtml && grep -c "Model.Directorate" Views/Account/Profile.cshtml && grep -c "Model.Section" Views/Account/Profile.cshtml && grep -c "Model.Unit" Views/Account/Profile.cshtml && grep -c "Model.Position" Views/Account/Profile.cshtml && grep -c "ViewBag.UserRole" Views/Account/Profile.cshtml && grep -c "text-muted..—" Views/Account/Profile.cshtml && echo "ALL BINDINGS PRESENT"</automated>
  </verify>
  <done>
- Profile.cshtml declares @model HcPortal.Models.ApplicationUser
- All 9 fields bound to @Model properties (FullName, NIP, Email, PhoneNumber, Directorate, Section, Unit, Position, Role via ViewBag)
- Null/empty fields display "—" em dash in text-muted span
- Avatar initials computed from Model.FullName using same algorithm as _Layout.cshtml
- Two sections (Identitas + Organisasi) with divider, no cards, flat label-value rows
- No hardcoded placeholder strings ("Budi Santoso", "759921", etc.) remain
- JoinDate, Location, "Active Employee" badge are NOT present
- "Edit Profile" link to Settings page preserved
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify no hardcoded placeholders remain and build compiles</name>
  <files>Views/Account/Profile.cshtml</files>
  <action>
Run verification checks to confirm the rewrite is complete and correct:

1. **No hardcoded strings remain** — grep for old placeholder values that MUST NOT exist:
   - "Budi Santoso" (old hardcoded name)
   - "759921" (old hardcoded NIP)
   - "budi.santoso" (old hardcoded email)
   - "+62 812" (old hardcoded phone)
   - "15 August 2018" (old hardcoded join date)
   - "Head Office" (old hardcoded location)
   - ">BS<" (old hardcoded avatar initials — the literal string BS between HTML tags)

2. **@model directive present** — first line must be `@model HcPortal.Models.ApplicationUser`

3. **Build compiles** — run `dotnet build` to verify no Razor compilation errors. Build MSB3021/MSB3027 file-lock warnings are expected if the app is running and are NOT compilation errors — ignore those.

4. **Initials algorithm match** — verify the initials code in Profile.cshtml uses `Split(' ', StringSplitOptions.RemoveEmptyEntries)` and the same 3-branch logic as _Layout.cshtml (nameParts.Length >= 2 → first char of first two words; else fullName.Length >= 2 → first 2 chars; else "?").

If any hardcoded placeholder is found, replace it with the correct @Model binding. If build fails with a Razor error (not a file-lock warning), fix the syntax.
  </action>
  <verify>
    <automated>cd "C:/Users/Administrator/Desktop/PortalHC_KPB" && ! grep -q "Budi Santoso" Views/Account/Profile.cshtml && ! grep -q "759921" Views/Account/Profile.cshtml && ! grep -q "budi.santoso" Views/Account/Profile.cshtml && ! grep -q "Head Office" Views/Account/Profile.cshtml && ! grep -q "15 August 2018" Views/Account/Profile.cshtml && echo "NO HARDCODED PLACEHOLDERS" && dotnet build --no-restore -v q 2>&1 | tail -5</automated>
  </verify>
  <done>
- Zero hardcoded placeholder strings in Profile.cshtml
- dotnet build succeeds (no Razor compilation errors)
- Initials algorithm matches _Layout.cshtml pattern exactly
  </done>
</task>

</tasks>

<verification>
**Phase-level verification:**

1. Navigate to /Account/Profile as a logged-in user
2. All displayed fields (Nama, NIP, Email, Telepon, Direktorat, Bagian, Unit, Jabatan, Role) show the actual logged-in user's data
3. For any field that is null/empty in the database, "—" is displayed in muted gray text
4. Avatar initials circle shows the correct 2-letter initials derived from the user's FullName — matches the navbar avatar
5. No "Budi Santoso", "759921", or other hardcoded placeholder text visible
6. Layout is two sections (Identitas + Organisasi) with divider, no card borders, professional corporate style
7. "Edit Profile" button links to /Account/Settings
</verification>

<success_criteria>
- PROF-01: Profile page displays real user data from @Model (Nama, NIP, Email, Phone, Position, Section, Unit, Directorate, Role)
- PROF-02: Null/empty fields show "—" em dash in muted style (CONTEXT override: em dash, not "Belum diisi")
- PROF-03: Avatar initials dynamically generated from Model.FullName using _Layout.cshtml algorithm
- No hardcoded placeholder strings remain in Profile.cshtml
- dotnet build compiles without Razor errors
</success_criteria>

<output>
After completion, create `.planning/phases/67-dynamic-profile-page/67-01-SUMMARY.md`
</output>
