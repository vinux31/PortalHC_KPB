---
phase: 68-functional-settings-page
plan: 02
type: execute
wave: 2
depends_on: [68-01]
files_modified:
  - Views/Account/Settings.cshtml
autonomous: true
requirements:
  - PROF-04
  - PROF-05
  - PROF-06

must_haves:
  truths:
    - "Edit Profile form shows editable FullName/Position/PhoneNumber fields pre-populated from user data"
    - "Edit Profile form shows read-only NIP/Email/Role/Section/Directorate/Unit as disabled inputs with 'Dikelola oleh admin' hint"
    - "Change Password form has CurrentPassword/NewPassword/ConfirmNewPassword fields with validation"
    - "Password submit button shows confirmation dialog before submitting"
    - "Section-specific TempData alerts appear above each form section on success/error"
    - "Non-functional items (2FA, Notifications, Language) are disabled with 'Segera Hadir' badge"
    - "Page has breadcrumb link back to Profile and heading 'Pengaturan Akun'"
  artifacts:
    - path: "Views/Account/Settings.cshtml"
      provides: "Complete Settings page with 3 sections"
      contains: "@model HcPortal.Models.SettingsViewModel"
  key_links:
    - from: "Views/Account/Settings.cshtml"
      to: "Controllers/AccountController.cs"
      via: "asp-action EditProfile and ChangePassword form targets"
      pattern: "asp-action=\"EditProfile\"|asp-action=\"ChangePassword\""
    - from: "Views/Account/Settings.cshtml"
      to: "Models/SettingsViewModel.cs"
      via: "@model binding + asp-for nested property references"
      pattern: "asp-for=\"EditProfile\\.|asp-for=\"ChangePassword\\."
---

<objective>
Rewrite Settings.cshtml from the current dummy card layout to a functional three-section settings page consistent with Phase 67 Profile visual patterns.

Purpose: Connect the backend ViewModels and POST actions (from Plan 01) to the user-facing Settings UI — making change password, edit profile, and non-functional item display all work.

Output: Views/Account/Settings.cshtml — complete rewrite with Edit Profile form, Change Password form, and Pengaturan Lainnya disabled section.
</objective>

<execution_context>
@C:/Users/Administrator/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Administrator/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/68-functional-settings-page/68-CONTEXT.md
@.planning/phases/68-functional-settings-page/68-RESEARCH.md
@.planning/phases/68-functional-settings-page/68-01-SUMMARY.md

<interfaces>
<!-- Key types and contracts from Plan 01. Executor MUST reference these. -->

From Models/SettingsViewModel.cs (created by Plan 01):
```csharp
public class SettingsViewModel
{
    public EditProfileViewModel EditProfile { get; set; } = new();
    public ChangePasswordViewModel ChangePassword { get; set; } = new();
    public string? NIP { get; set; }
    public string? Email { get; set; }
    public string Role { get; set; } = "—";
    public string? Section { get; set; }
    public string? Directorate { get; set; }
    public string? Unit { get; set; }
}

public class EditProfileViewModel
{
    [Required] public string FullName { get; set; }  // editable
    public string? Position { get; set; }             // editable
    public string? PhoneNumber { get; set; }          // editable
}

public class ChangePasswordViewModel
{
    [Required] public string CurrentPassword { get; set; }
    [Required] public string NewPassword { get; set; }
    [Required][Compare("NewPassword")] public string ConfirmNewPassword { get; set; }
}
```

From Controllers/AccountController.cs (updated by Plan 01):
```csharp
// GET  /Account/Settings — returns View(SettingsViewModel)
// POST /Account/EditProfile — accepts [Bind(Prefix="EditProfile")] EditProfileViewModel
// POST /Account/ChangePassword — accepts [Bind(Prefix="ChangePassword")] ChangePasswordViewModel
// TempData keys: ProfileSuccess, ProfileError, PasswordSuccess, PasswordError
```

From Views/Account/Profile.cshtml (visual pattern reference):
```html
<!-- Layout: row justify-content-center > col-md-8 col-lg-7 -->
<!-- Section heading: <p class="text-uppercase fw-bold small text-muted mb-3"> -->
<!-- Field row: <div class="row mb-2 py-1"><div class="col-sm-4 text-muted small fw-medium">Label</div><div class="col-sm-8">Value</div></div> -->
<!-- Section divider: <hr class="my-4"> -->
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite Settings.cshtml with Edit Profile form, Change Password form, and non-functional items</name>
  <files>Views/Account/Settings.cshtml</files>
  <action>
Complete rewrite of Views/Account/Settings.cshtml. Delete ALL existing content and replace with:

**Page setup:**
```razor
@model HcPortal.Models.SettingsViewModel
@{
    ViewData["Title"] = "Pengaturan Akun";
}
```

**Outer container:** `<div class="row justify-content-center"><div class="col-md-8 col-lg-7">` — same as Profile.cshtml.

**Breadcrumb/back link at top:**
```html
<a asp-controller="Account" asp-action="Profile" class="text-decoration-none small text-muted d-inline-block mb-3">
    <i class="bi bi-arrow-left me-1"></i> Kembali ke Profil
</a>
```

**Page heading:** `<h4 class="fw-bold mb-4">Pengaturan Akun</h4>`

**--- SECTION 1: Edit Profil ---**

Section-specific alert (ProfileSuccess/ProfileError) placed ABOVE the section heading:
```razor
@if (TempData["ProfileSuccess"] != null)
{
    <div class="alert alert-success alert-dismissible fade show mb-3" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>@TempData["ProfileSuccess"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
@if (TempData["ProfileError"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
        <i class="bi bi-x-circle-fill me-2"></i>@TempData["ProfileError"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
```

Section heading: `<p class="text-uppercase fw-bold small text-muted mb-3">Edit Profil</p>`

Form: `<form asp-action="EditProfile" method="post">` with `@Html.AntiForgeryToken()`

**Editable fields** (3 fields) — each uses this pattern:
```html
<div class="row mb-3">
    <div class="col-sm-4">
        <label asp-for="EditProfile.FullName" class="col-form-label text-muted small fw-medium">Nama Lengkap</label>
    </div>
    <div class="col-sm-8">
        <input asp-for="EditProfile.FullName" class="form-control" />
        <span asp-validation-for="EditProfile.FullName" class="text-danger small"></span>
    </div>
</div>
```
- FullName: label "Nama Lengkap"
- Position: label "Jabatan"
- PhoneNumber: label "Nomor Telepon"

**Read-only fields** (6 fields) — each uses this pattern:
```html
<div class="row mb-3">
    <div class="col-sm-4">
        <label class="col-form-label text-muted small fw-medium">NIP</label>
    </div>
    <div class="col-sm-8">
        <input type="text" class="form-control" value="@(Model.NIP ?? "—")" disabled />
        <div class="form-text text-muted small">Dikelola oleh admin</div>
    </div>
</div>
```
Fields in order: NIP ("NIP"), Email ("Email"), Role ("Role"), Bagian/Section ("Bagian"), Direktorat/Directorate ("Direktorat"), Unit ("Unit").

Submit button: `<button type="submit" class="btn btn-primary mt-2">Simpan Profil</button>`

Close form tag.

**Divider:** `<hr class="my-4">`

**--- SECTION 2: Ubah Password ---**

Section-specific alert (PasswordSuccess/PasswordError) placed ABOVE the section heading:
Same pattern as ProfileSuccess/ProfileError but using PasswordSuccess/PasswordError TempData keys.

Section heading: `<p class="text-uppercase fw-bold small text-muted mb-3">Ubah Password</p>`

Form: `<form asp-action="ChangePassword" method="post" id="changePasswordForm">` with `@Html.AntiForgeryToken()`

**Password fields** (3 fields):
- CurrentPassword: label "Password Lama", `<input asp-for="ChangePassword.CurrentPassword" class="form-control" type="password" autocomplete="current-password" />`
- NewPassword: label "Password Baru", `type="password" autocomplete="new-password"`
- ConfirmNewPassword: label "Konfirmasi Password Baru", `type="password" autocomplete="new-password"`
- Each with `<span asp-validation-for="ChangePassword.XXX" class="text-danger small"></span>`

Submit button with confirmation: `<button type="submit" class="btn btn-primary mt-2" onclick="return confirm('Yakin ubah password?')">Ubah Password</button>`

Close form tag.

**Divider:** `<hr class="my-4">`

**--- SECTION 3: Pengaturan Lainnya ---**

Section heading: `<p class="text-uppercase fw-bold small text-muted mb-3">Pengaturan Lainnya</p>`

Three disabled items (no form, pure display):

1. **Two-Factor Authentication:**
```html
<div class="row mb-3 py-1">
    <div class="col-sm-8">
        <span class="text-muted">Two-Factor Authentication</span>
        <span class="badge bg-secondary ms-2" style="font-size: 0.7rem;">Segera Hadir</span>
    </div>
    <div class="col-sm-4 text-end">
        <div class="form-check form-switch d-inline-block">
            <input class="form-check-input" type="checkbox" disabled />
        </div>
    </div>
</div>
```

2. **Email Notifications:** Same pattern, label "Notifikasi Email", toggle switch disabled.

3. **Language:** Same pattern but with disabled select dropdown instead of toggle:
```html
<div class="col-sm-4 text-end">
    <select class="form-select form-select-sm w-auto" disabled>
        <option selected>Bahasa Indonesia</option>
    </select>
</div>
```

**Close outer divs.**

**Key styling decisions (Claude's discretion per CONTEXT):**
- Use native `confirm()` dialog for password change (simple, consistent)
- No auto-dismiss on alerts (user dismisses manually via close button)
- Editable fields grouped first, then read-only fields separated by a small gap or visual cue within the Edit Profil section
- Keep responsive: col-sm-4/col-sm-8 form layout collapses to stacked on mobile
  </action>
  <verify>
    <automated>cd C:/Users/Administrator/Desktop/PortalHC_KPB && dotnet build --no-restore 2>&1 | tail -5</automated>
  </verify>
  <done>Settings.cshtml is fully rewritten with: @model SettingsViewModel, back-to-profile link, "Pengaturan Akun" heading, Edit Profil form (3 editable + 6 read-only fields + Simpan Profil button), Ubah Password form (3 password fields + confirm dialog + Ubah Password button), Pengaturan Lainnya section (3 disabled items with "Segera Hadir" badges). Section-specific TempData alerts positioned above each form. Build succeeds.</done>
</task>

</tasks>

<verification>
1. `dotnet build` compiles with 0 errors
2. Settings page uses @model HcPortal.Models.SettingsViewModel
3. Edit Profile form targets asp-action="EditProfile" with asp-for="EditProfile.FullName" etc.
4. Change Password form targets asp-action="ChangePassword" with asp-for="ChangePassword.CurrentPassword" etc.
5. Read-only fields (NIP, Email, Role, Section, Directorate, Unit) are disabled inputs with "Dikelola oleh admin" hint
6. Non-functional items (2FA, Notifications, Language) are disabled with "Segera Hadir" badge
7. Section-specific TempData alerts (ProfileSuccess/ProfileError/PasswordSuccess/PasswordError) display above respective sections
8. Password submit has native confirm() dialog
9. Visual style matches Phase 67 Profile page: flat rows, col-md-8, text-uppercase muted section headings, no cards
</verification>

<success_criteria>
- Settings.cshtml fully rewritten — no trace of old dummy card layout
- Edit Profile form submits to /Account/EditProfile with 3 editable fields + 6 read-only
- Change Password form submits to /Account/ChangePassword with 3 fields + confirmation dialog
- Pengaturan Lainnya section has 3 disabled items with "Segera Hadir" badges
- Page has "Kembali ke Profil" link and "Pengaturan Akun" heading
- `dotnet build` succeeds with 0 errors
</success_criteria>

<output>
After completion, create `.planning/phases/68-functional-settings-page/68-02-SUMMARY.md`
</output>
