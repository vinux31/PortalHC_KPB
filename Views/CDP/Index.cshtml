@model List<HcPortal.Models.IdpCompetency>

@{
    ViewData["Title"] = "Plan IDP (Silabus)";
}

    <style>
        /* Sticky Header */
        .table-responsive {
            max-height: 80vh; /* Allow scrolling if table is very long */
            overflow-y: auto;
        }
        thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #f8f9fa !important; /* Ensure background is opaque */
            box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.1);
        }

        /* Custom List Markers */
        .custom-list li {
            position: relative;
            padding-left: 1.2rem;
            margin-bottom: 0.5rem;
        }
        .custom-list li::before {
            content: "\F285"; /* Bootstrap Icon: chevron-right */
            font-family: "bootstrap-icons";
            position: absolute;
            left: 0;
            top: 2px;
            color: var(--bs-primary);
            font-size: 0.75rem;
            font-weight: bold;
        }

        /* Stronger Separator */
        .group-separator {
            border-bottom: 3px solid #dee2e6 !important;
        }
    </style>

<div class="d-flex justify-content-between align-items-end mb-4">
    <div>
        <h2 class="fw-bold text-primary">Plan IDP (Silabus)</h2>
        <div class="d-flex gap-4 mt-2">
            <div>
                <span class="text-muted small d-block">Coachee</span>
                <span class="fw-bold">User (Anda)</span>
            </div>
            <div>
                <span class="text-muted small d-block">Coach</span>
                <span class="fw-bold">Budi Santoso</span>
            </div>
        </div>
    </div>
    
    <div class="text-end">
        <div class="mb-1">
            <span class="fw-bold text-secondary">Penugasan Tahun 2025, Unit 22</span>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-bordered align-middle mb-0">
                <thead class="bg-light text-secondary small text-uppercase text-center align-middle">
                    <tr>
                        <th rowspan="2" class="p-3" style="width: 25%">Nama Kompetensi CPDP</th>
                        <th rowspan="2" class="p-3" style="width: 15%">Implementasi Pembelajaran</th>
                        <th colspan="2" class="p-3">Nama Sub Kompetensi CPDP</th>
                    </tr>
                    <tr>
                        <th class="p-3" style="width: 30%">Operator</th>
                        <th class="p-3" style="width: 30%">Panelman</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var comp in Model)
                    {
                        var periods = comp.Periods;
                        var rowCount = periods.Count;
                        
                        @for (int i = 0; i < rowCount; i++)
                        {
                            var period = periods[i];
                            // Add separator class to the last row of the competency
                            var trClass = (i == rowCount - 1) ? "group-separator" : "";
                            
                            <tr class="@trClass">
                                @if (i == 0)
                                {
                                    <td rowspan="@rowCount" class="p-3 fw-bold bg-white align-top">
                                        @comp.Name
                                    </td>
                                }
                                <td class="p-3 text-center align-top bg-white">
                                    @period.PeriodName
                                </td>
                                <td class="p-2 align-top bg-white">
                                    <ul class="list-unstyled mb-0 small custom-list">
                                        @foreach (var op in period.OperatorCompetencies)
                                        {
                                            <li>@op</li>
                                        }
                                    </ul>
                                </td>
                                <td class="p-2 align-top bg-white">
                                     <ul class="list-unstyled mb-0 small custom-list">
                                        @foreach (var pm in period.PanelmanCompetencies)
                                        {
                                            <li>@pm</li>
                                        }
                                    </ul>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>