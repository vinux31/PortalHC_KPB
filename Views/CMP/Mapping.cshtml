@model List<HcPortal.Models.CpdpItem>

@{
    ViewData["Title"] = "Mapping CPDP";
    // Variabel bantu untuk grouping tampilan
    string currentKompetensi = "";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold">Mapping KKJ - IDP (CPDP)</h2>
        <p class="text-muted">Kurikulum Pengembangan Kompetensi: Operator vs Panelman</p>
    </div>
    <button class="btn btn-primary"><i class="bi bi-printer"></i> Print Kurikulum</button>
</div>

<div class="card shadow-sm">
    <div class="card-body p-0">
        <table class="table table-bordered table-hover align-middle mb-0">
            <thead class="bg-dark text-white text-center">
                <tr>
                    <th style="width: 25%">Nama Kompetensi CPDP</th>
                    <th style="width: 15%">Implementasi</th>
                    <th style="width: 5%">No</th>
                    <th style="width: 27%">Operator</th>
                    <th style="width: 28%">Panelman</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    // Logika Pewarnaan Baris berdasarkan Tahun
                    string rowClass = "";
                    if (item.Implementasi == "Tahun Pertama") { rowClass = "bg-opacity-10 bg-success"; } 
                    else if (item.Implementasi == "Tahun Kedua") { rowClass = "bg-opacity-10 bg-warning"; }
                    else if (item.Implementasi == "Tahun Ketiga") { rowClass = "bg-opacity-10 bg-danger"; }

                    <tr class="@rowClass">
                        <td class="fw-bold text-dark">
                            @if(currentKompetensi != item.Kompetensi)
                            {
                                @item.Kompetensi
                                currentKompetensi = item.Kompetensi; // Update tracker
                            }
                            else 
                            { 
                                <span class="text-muted small" style="opacity: 0.3">"</span> 
                            }
                        </td>

                        <td class="text-center small fw-bold">
                             @if(item.Implementasi == "Tahun Pertama") { <span class="badge bg-success">Tahun 1</span> }
                             else if(item.Implementasi == "Tahun Kedua") { <span class="badge bg-warning text-dark">Tahun 2</span> }
                             else { <span class="badge bg-danger">Tahun 3</span> }
                        </td>

                        <td class="text-center text-muted small">@item.KodeSub</td>
                        <td>@item.SubOps</td>
                        <td>
                            @if(item.SubPanel == "-") {
                                <span class="text-muted">-</span>
                            } else {
                                @item.SubPanel
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>